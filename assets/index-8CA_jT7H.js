(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=s(a);fetch(a.href,r)}})();const jt="vite-refactor/6.1.0",Te="marnthara.input.v6.1",qt="marnthara.shop.config.v1",Wt=500,ye={name:"",address:"",phone:"",taxId:"",logoUrl:"",baseVatRate:.07,pdf:{paymentTerms:"‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥ 50%",priceValidity:"30 ‡∏ß‡∏±‡∏ô",notes:["- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£"]}},Vt=1.19599,Gt={ROLL_WIDTH_M:.53,STRIPS_PER_ROLL_UNDER_2_5M:3},Fe={fabric:[1e3,1100,1200,1300,1400,1500,1600,1700,1800,1900,2e3,2100,2200,2300,2400,2500,2600,2700,2800,2900,3e3],sheer:[1e3,1100,1200,1300,1400,1500],louis:[2200,2300,2400,2500,2600,2700,2800,2900,3e3,3100,3200,3300,3400,3500],style_surcharge:{‡∏•‡∏≠‡∏ô:200,‡∏ï‡∏≤‡πÑ‡∏Å‡πà:0,‡∏à‡∏µ‡∏ö:0,‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö:0,‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö:0,‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå:0}},W={set:{templateId:"#setTpl",name:"‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô"},wallpaper:{templateId:"#wallpaperTpl",name:"‡∏ß‡∏≠‡∏•‡∏•‡πå‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå"},wooden_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ"},roller_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô"},vertical_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á"},partition:{templateId:"#areaBasedTpl",name:"‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á"},pleated_screen:{templateId:"#areaBasedTpl",name:"‡∏°‡∏∏‡πâ‡∏á‡∏à‡∏µ‡∏ö"},removal:{templateId:"#removalTpl",name:"‡∏£‡∏∑‡πâ‡∏≠‡∏ñ‡∏≠‡∏ô"},aluminum_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°"}},_={orderForm:"#orderForm",roomsContainer:"#rooms",toastContainer:"#toast-container",printableContent:"#printable-content",filterStatusBar:"#filterStatusBar",menuBtn:"#menuBtn",menuDropdown:"#menuDropdown",shopSettingsBtn:"#shopSettingsBtn",undoBtn:"#undoBtn",themeToggleBtn:"#themeToggleBtn",overviewBtn:"#overviewBtn",copyTextBtn:"#copyTextBtn",visualReportsBtn:"#visualReportsBtn",exportPdfBtn:"#exportPdfBtn",submitBtn:"#submitBtn",importBtn:"#importBtn",exportBtn:"#exportBtn",importFavsBtn:"#importFavsBtn",exportFavsBtn:"#exportFavsBtn",clearItemsBtn:"#clearItemsBtn",clearAllBtn:"#clearAllBtn",lockBtn:"#lockBtn",quickNavBtn:"#quickNavBtn",quickNavDropdown:"#quickNavDropdown",quickNavRoomList:"#quickNavRoomList",quickNavBtnText:"#quickNavBtnText",toggleAllRoomsBtn:"#toggleAllRoomsBtn",suspendedItemsBtn:"#suspendedItemsBtn",suspendedCountBadge:"#suspendedCountBadge",originalTotal:"#originalTotal",grandTotal:"#grandTotal",fileImporter:"#fileImporter",favImporter:"#favImporter",customerCard:"#customerDetailsCard",customerNameInput:"#customer_name",customerPhoneInput:"#customer_phone",customerAddressInput:"#customer_address",room:".room-card",roomTpl:"#roomTpl",roomNameInput:'input[name="room_name"]',roomNameDisplay:"[data-room-name-display]",roomBrief:"[data-room-brief]",allItemsContainer:"[data-all-items]",roomDefaultsBtn:'[data-act="open-room-defaults"]',itemCard:".item-card",itemDetailsMore:".item-details-more",itemGrid:".item-grid",itemTitle:"[data-item-title]",toggleDetailsBtn:'[data-act="toggle-more-details"]',setTpl:"#setTpl",setWidthInput:'input[name="width_m"]',setHeightInput:'input[name="height_m"]',setStyleSelect:'select[name="set_style"]',setFabricVariantSelect:'select[name="fabric_variant"]',setPricePerMSelect:'select[name="set_price_per_m"]',setSheerPricePerMSelect:'select[name="sheer_price_per_m"]',setLouisPricePerMSelect:'select[name="louis_price_per_m"]',setFabricCodeInput:'input[name="fabric_code"]',setSheerCodeInput:'input[name="sheer_fabric_code"]',setOpeningStyleSelect:'select[name="opening_style"]',setAdjustmentSideSelect:'select[name="adjustment_side"]',setTrackColorInput:'input[name="track_color"]',setBracketColorInput:'input[name="bracket_color"]',setFinialColorInput:'input[name="finial_color"]',setGrommetColorInput:'input[name="grommet_color"]',setLouisValanceInput:'input[name="louis_valance"]',setLouisTasselsInput:'input[name="louis_tassels"]',setNotesInput:'input[name="notes"]',wallpaperTpl:"#wallpaperTpl",wallTpl:"#wallTpl",wallHeightInput:'[name="wallpaper_height_m"]',wallCodeInput:'[name="wallpaper_code"]',wallPriceRollInput:'[name="wallpaper_price_roll"]',wallInstallCostInput:'[name="wallpaper_install_cost"]',wallNotesInput:'[name="wallpaper_notes"]',wallWidthInput:'[name="wall_width_m"]',areaBasedTpl:"#areaBasedTpl",removalTpl:"#removalTpl",areaBasedItem:".area-based-item",areaWidthInput:'[name="area_width_m"]',areaHeightInput:'[name="area_height_m"]',areaPriceSqydInput:'[name="area_price_sqyd"]',areaCodeInput:'[name="area_code"]',areaNotesInput:'[name="area_notes"]',modal:"#confirmationModal",modalTitle:"#modalTitle",modalBody:"#modalBody",discountModal:"#discountModal",discountSubtotal:"#discountSubtotal",discountPercent:"#discountPercent",discountAmount:"#discountAmount",discountFinalTotal:"#discountFinalTotal",discountTypeInput:"#discount_type",discountValueInput:"#discount_value",copyOptionsModal:"#copyOptionsModal",visualReportsModal:"#visualReportsModal",lookbookModal:"#lookbookModal",lookbookModalBody:"#lookbookModalBody",exportOptionsModal:"#exportOptionsModal",pdfOptionsModal:"#pdfOptionsModal",exportPdfWithDetailsBtn:"#exportPdfWithDetailsBtn",exportPdfWithoutDetailsBtn:"#exportPdfWithoutDetailsBtn",itemTypeModal:"#itemTypeModal",itemTypeModalTitle:"#itemTypeModalTitle",hardwareModal:"#hardwareModal",modalTrackColor:'[name="modal_track_color"]',modalBracketColor:'[name="modal_bracket_color"]',modalFinialColor:'[name="modal_finial_color"]',modalGrommetColor:'[name="modal_grommet_color"]',modalLouisValance:'[name="modal_louis_valance"]',modalLouisTassels:'[name="modal_louis_tassels"]',trackColorGroup:"#trackColorGroup",bracketColorGroup:"#bracketColorGroup",finialColorGroup:"#finialColorGroup",grommetColorGroup:"#grommetColorGroup",louisValanceGroup:"#louisValanceGroup",louisTasselGroup:"#louisTasselGroup",hardwareApplyToRoomBtn:"#hardwareApplyToRoom",favoritesConflictModal:"#favoritesConflictModal",favoritesModal:"#favoritesModal",favoritesModalTitle:"#favoritesModalTitle",favoritesModalBody:"#favoritesModalBody",favSearchInput:"#favSearchInput",favSelectorItemTpl:"#favSelectorItemTpl",favInput:"input[data-favorite-type]",favManagerModal:"#favManagerModal",favManagerTitle:"#favManagerTitle",favManagerBody:"#favManagerBody",favManagerItemTpl:"#favManagerItemTpl",favManagerEditBtn:'#favManagerModal [data-act="edit-selected-fav"]',favManagerDelBtn:'#favManagerModal [data-act="del-selected-fav"]',favAddModal:"#favAddModal",favAddCodeInput:'[name="fav_code_add"]',favAddPriceInput:'[name="fav_price_add"]',favEditModal:"#favEditModal",favEditCodeInput:'[name="fav_code_edit"]',favEditPriceInput:'[name="fav_price_edit"]',roomDefaultsModal:"#roomDefaultsModal",roomDefaultsForm:"#roomDefaultsForm",roomDefaultsApplyBtn:"#roomDefaultsApplyBtn",roomDefaultsConfirmBtn:"#roomDefaultsConfirmBtn",roomDefaultsCancelBtn:"#roomDefaultsCancelBtn",roomControlCenterModal:"#roomControlCenterModal",rccTabs:".rcc-tabs .tab-link",rccContentPanels:".rcc-tab-content",batchDeviceTypeSelect:"#batch-select-device-type",batchDeviceListContainer:"#batch-device-list-container",batchSelectAllCheckbox:"#batch-select-all-checkbox",batchTargetTypeSelect:"#batch-target-device-type",batchCurtainDetailsPanel:"#batch-curtain-type-options",batchCurtainTypeSelect:"#batch-curtain-type",batchConfirmBtn:"#batchEditorConfirmBtn",overviewModal:"#overviewModal",overviewModalHeader:"#overviewModalHeader",overviewModalBody:"#overviewModalBody",shopSettingsModal:"#shopSettingsModal",shopSettingsForm:"#shopSettingsForm",shopSettingsSaveBtn:'#shopSettingsModal [data-act="save-shop-config"]'},h=e=>{typeof e=="string"&&(e=e.replace(/,/g,""));const n=parseFloat(e);return Number.isFinite(n)?n:0},ee=e=>{const n=h(e);return n>0?n.toFixed(2):""},ot=e=>{const n=e.target,s=n.value.trim();if(s===""){n.value="";return}let o=h(s);if(o<=0){n.value="";return}o>=10&&o%1===0&&(o=o/100),n.value=ee(o)},ie=(e,n=2,s=!1)=>Number.isFinite(e)?e.toLocaleString("en-US",{minimumFractionDigits:s?2:n,maximumFractionDigits:s?2:n}):"0",E=(e,n=2)=>Number.isFinite(e)?e.toLocaleString("th-TH",{minimumFractionDigits:n,maximumFractionDigits:n}):"0.00",$e=(e,n=150)=>{let s;return(...o)=>{clearTimeout(s),s=setTimeout(()=>e(...o),n)}},Ut=(e,n=200)=>{let s=0,o;return(...a)=>{const r=new Date().getTime();o&&(clearTimeout(o),o=null),r-s>=n?(s=r,e(...a)):o=setTimeout(()=>{s=new Date().getTime(),e(...a),o=null},n-(r-s))}},C=e=>e?e.replace(/[<>"'&]/g,n=>{switch(n){case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";case"&":return"&amp;";default:return n}}):"",$t=e=>e?e.replace(/[<>:"/\\|?*]/g,"").replace(/[\s\n\t]+/g,"_").substring(0,100):"file";function Jt(e){if(e=h(e),e===0)return"‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô";if(e<0||e>99999999999999e-2)return"N/A";const n=["‡∏®‡∏π‡∏ô‡∏¢‡πå","‡∏´‡∏ô‡∏∂‡πà‡∏á","‡∏™‡∏≠‡∏á","‡∏™‡∏≤‡∏°","‡∏™‡∏µ‡πà","‡∏´‡πâ‡∏≤","‡∏´‡∏Å","‡πÄ‡∏à‡πá‡∏î","‡πÅ‡∏õ‡∏î","‡πÄ‡∏Å‡πâ‡∏≤","‡∏™‡∏¥‡∏ö"],s=["","‡∏™‡∏¥‡∏ö","‡∏£‡πâ‡∏≠‡∏¢","‡∏û‡∏±‡∏ô","‡∏´‡∏°‡∏∑‡πà‡∏ô","‡πÅ‡∏™‡∏ô","‡∏•‡πâ‡∏≤‡∏ô"];e=parseFloat(e.toFixed(2));let o=Math.floor(e),a=Math.round((e-o)*100);const r=t=>{if(t===0)return"";let l="";const d=String(t);for(let i=0;i<d.length;i++){const f=d[i],u=d.length-i-1;f!=="0"&&(u===1&&f==="1"?l+=s[u]:u===1&&f==="2"?l+="‡∏¢‡∏µ‡πà"+s[u]:u===0&&f==="1"&&d.length>1?l+="‡πÄ‡∏≠‡πá‡∏î":l+=n[parseInt(f)]+s[u])}return l};let c="";if(o>0){const t=Math.floor(o/1e6),l=o%1e6;t>0&&(c+=r(t)+"‡∏•‡πâ‡∏≤‡∏ô"),c+=r(l),c+="‡∏ö‡∏≤‡∏ó"}else a>0?c="":c="‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó";return a===0?o>=0&&(c+="‡∏ñ‡πâ‡∏ß‡∏ô"):c+=r(a)+"‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå",c}function _e(e){const n=e.target.value;n!=="0"&&n!=="0.00"&&h(n)>0&&(e.target.value=h(n))}function ve(e){const n=h(e.target.value);e.target.value=n===0?"0.00":n!=null&&n>0?E(n,2):""}const at="marnthara.favorites.v4",Ie={fabric:[],sheer:[],wallpaper:[],wooden_blind:[],roller_blind:[],vertical_blind:[],partition:[],pleated_screen:[],aluminum_blind:[]};function ge(){try{const e=localStorage.getItem(at);return e?{...Ie,...JSON.parse(e)}:Ie}catch(e){return console.error("Failed to parse favorites from localStorage",e),Ie}}function Ve(e){try{localStorage.setItem(at,JSON.stringify(e))}catch(n){console.error("Failed to save favorites to localStorage",n)}}function dt(e){if(!e||typeof e!="object")return console.error("Invalid favorites data for import."),!1;const n={...Ie,...e};return Ve(n),!0}function Ze(e){if(!e||typeof e!="object")return console.error("Invalid favorites data for merge."),0;const n=ge();let s=0;for(const o in e)Object.prototype.hasOwnProperty.call(e,o)&&Array.isArray(e[o])&&(n[o]||(n[o]=[]),e[o].forEach(a=>{a&&a.code&&Object.prototype.hasOwnProperty.call(a,"price")?n[o].some(c=>c.code===a.code)||(n[o].push({code:a.code,price:a.price}),s++):console.warn(`Skipping invalid favorite item during merge for type ${o}:`,a)}),n[o].sort((a,r)=>a.code.localeCompare(r.code)));return s>0&&Ve(n),s}function ut(e,n,s){const o=ge(),a=n?.trim();if(!a)return console.error(`Attempted to add favorite with empty code for type: ${e}`),!1;if(typeof s!="number"||isNaN(s)||s<0)return console.error(`Attempted to add favorite with invalid price (${s}) for code ${a}`),!1;if(!Object.prototype.hasOwnProperty.call(Ie,e))return console.error(`Attempted to add favorite to an invalid type: ${e}`),!1;o[e]||(o[e]=[]);const r=o[e],c=r.find(t=>t.code===a);return c?c.price=s:r.push({code:a,price:s}),r.sort((t,l)=>t.code.localeCompare(l.code)),Ve(o),!0}function pt(e,n){const s=ge(),o=n?.trim();if(!s[e]||!o)return!1;const a=s[e].findIndex(r=>r.code===o);return a>-1?(s[e].splice(a,1),Ve(s),!0):!1}function Yt(){localStorage.removeItem(at),console.log("All favorites have been cleared.")}function K(){const e=ge(),n={app_version:jt,customer_name:document.querySelector(_.customerNameInput)?.value||"",customer_phone:document.querySelector(_.customerPhoneInput)?.value||"",customer_address:document.querySelector(_.customerAddressInput)?.value||"",customer_card_open:document.querySelector(_.customerCard)?.open,discount:{type:document.querySelector(_.discountTypeInput)?.value||"amount",value:h(document.querySelector(_.discountValueInput)?.value)},rooms:[],favorites:e};return document.querySelectorAll(_.room).forEach(s=>{const o={id:s.id,room_name:s.querySelector(_.roomNameInput)?.value||"",is_suspended:s.classList.contains("is-suspended"),is_open:s.open,room_defaults:JSON.parse(s.dataset.roomDefaults||"{}"),items:[]};s.querySelector(_.allItemsContainer)?.childNodes.forEach(a=>{if(a.nodeType!==1||!a.matches(_.itemCard))return;if(a.classList.contains("placeholder-item")){const t={type:"placeholder",is_suspended:a.classList.contains("is-suspended"),width_m:h(a.dataset.widthM),height_m:h(a.dataset.heightM)};o.items.push(t);return}const r=a.dataset.type;if(!r)return;let c={type:r,is_suspended:a.classList.contains("is-suspended"),enable_set_price:a.querySelector('[name="enable_set_price"]')?.checked||!1,set_price_override:h(a.querySelector('[name="set_price_override"]')?.value)};if(r==="set")Object.assign(c,{width_m:h(a.querySelector(_.setWidthInput)?.value),height_m:h(a.querySelector(_.setHeightInput)?.value),style:a.querySelector(_.setStyleSelect)?.value||"",fabric_variant:a.querySelector(_.setFabricVariantSelect)?.value||"",price_per_m_raw:h(a.querySelector(_.setPricePerMSelect)?.value),sheer_price_per_m:h(a.querySelector(_.setSheerPricePerMSelect)?.value),louis_price_per_m:h(a.querySelector(_.setLouisPricePerMSelect)?.value),fabric_code:a.querySelector(_.setFabricCodeInput)?.value||"",sheer_fabric_code:a.querySelector(_.setSheerCodeInput)?.value||"",opening_style:a.querySelector(_.setOpeningStyleSelect)?.value||"",adjustment_side:a.querySelector(_.setAdjustmentSideSelect)?.value||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤",track_color:a.querySelector(_.setTrackColorInput)?.value||"‡∏Ç‡∏≤‡∏ß",bracket_color:a.querySelector(_.setBracketColorInput)?.value||"‡∏Ç‡∏≤‡∏ß",finial_color:a.querySelector(_.setFinialColorInput)?.value||"‡∏Ç‡∏≤‡∏ß",grommet_color:a.querySelector(_.setGrommetColorInput)?.value||"‡πÄ‡∏á‡∏¥‡∏ô",louis_valance:a.querySelector(_.setLouisValanceInput)?.value||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",louis_tassels:a.querySelector(_.setLouisTasselsInput)?.value||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤",notes:a.querySelector(_.setNotesInput)?.value||""});else if(r==="wallpaper"){const t=a.querySelector(_.wallInstallCostInput),l=t?t.value:"";let d;l==="0"?d=0:h(l)>0?d=h(l):d=void 0,Object.assign(c,{height_m:h(a.querySelector(_.wallHeightInput)?.value),wallpaper_code:a.querySelector(_.wallCodeInput)?.value||"",price_per_roll:h(a.querySelector(_.wallPriceRollInput)?.value),install_cost_per_roll:d,notes:a.querySelector(_.wallNotesInput)?.value||"",widths:Array.from(a.querySelectorAll(_.wallWidthInput)).map(i=>h(i.value))})}else r==="removal"?Object.assign(c,{quantity:h(a.querySelector('input[name="quantity"]')?.value),price_per_item:h(a.querySelector('input[name="price_per_item"]')?.value),description:a.querySelector('input[name="description"]')?.value||"",notes:a.querySelector('input[name="notes"]')?.value||""}):a.matches(_.areaBasedItem)&&(Object.assign(c,{width_m:h(a.querySelector(_.areaWidthInput)?.value),height_m:h(a.querySelector(_.areaHeightInput)?.value),price_sqyd:h(a.querySelector(_.areaPriceSqydInput)?.value),code:a.querySelector(_.areaCodeInput)?.value||"",notes:a.querySelector(_.areaNotesInput)?.value||""}),(r==="partition"||r==="pleated_screen")&&(c.opening_style=a.querySelector('select[name="opening_style"]')?.value||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"),["wooden_blind","roller_blind","vertical_blind","aluminum_blind"].includes(r)&&(c.adjustment_side=a.querySelector('select[name="adjustment_side"]')?.value||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤"));o.items.push(c)}),n.rooms.push(o)}),n}function ne(){try{const e=K();localStorage.setItem(Te,JSON.stringify(e))}catch(e){console.error("Failed to save data to localStorage:",e)}}const be=[],Qt=10;function ue(e){if(!e){console.warn("Attempted to push invalid state to undo stack.");return}try{const n=JSON.parse(JSON.stringify(e));be.push(n),be.length>Qt&&be.shift()}catch(n){console.error("Failed to clone state for undo history:",n)}}function Kt(){if(be.length!==0)return be.pop()}function Xt(){return be.length>0}const F={getStyleSurcharge:e=>Fe.style_surcharge[e]||0,fabricYardage:(e,n)=>{const s=h(n);if(s<=0)return 0;let o=0;switch(e){case"‡∏ï‡∏≤‡πÑ‡∏Å‡πà":case"‡∏à‡∏µ‡∏ö":case"‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå":case"‡∏•‡∏≠‡∏ô":case"‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö":o=(s+.3)*2;break;case"‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö":o=s*1.3;break;default:return 0}const a=o/.9,r=Math.floor(a/50);return a+r},calculateGrommets:e=>{const n=h(e.width_m);if(n<=0||e.style!=="‡∏ï‡∏≤‡πÑ‡∏Å‡πà")return 0;const s=n*2.5;let a=Math.ceil(s*100/12);return a%2!==0&&a++,a},calculateSetPrice:function(e){if(!e||e.is_suspended)return{total:0,opaque:0,sheer:0,louis:0};if(e.enable_set_price&&h(e.set_price_override)>0)return{total:h(e.set_price_override),opaque:0,sheer:0,louis:0};const s=e.fabric_variant||"‡∏ó‡∏∂‡∏ö",o=e.style||"‡∏•‡∏≠‡∏ô",a=h(e.width_m);let r=0,c=0,t=0;const l=this.getStyleSurcharge(o),d=h(e.price_per_m_raw),i=h(e.sheer_price_per_m);if(o==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"){const m=h(e.louis_price_per_m);if(s.includes("‡∏ó‡∏∂‡∏ö")){const b=d+l;r=a*b}s.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(c=a*i),m>0&&(t=a*m)}else{if(s.includes("‡∏ó‡∏∂‡∏ö")){const m=d+l;r=a*m}s.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(c=a*i)}const f=r+c+t;let u=f;return f>0&&f<1200&&(u=1200),u=Math.round(u*100)/100,{total:u,opaque:Math.round(r*100)/100,sheer:Math.round(c*100)/100,louis:Math.round(t*100)/100}},calculateRemovalPrice:function(e){if(!e||e.is_suspended)return{total:0};const n=h(e.quantity),s=h(e.price_per_item);if(n<=0||s<=0)return{total:0};const o=n*s;return{total:Math.round(o*100)/100}},wallpaperRolls:(e,n)=>{if(e<=0||n<=0)return 0;const{ROLL_WIDTH_M:s,STRIPS_PER_ROLL_UNDER_2_5M:o}=Gt,a=Math.ceil(e/s);let r;return n<=2.5?r=o:r=2,Math.ceil(a/r)},calculateAreaBasedPrice:function(e){if(!e||e.is_suspended)return{total:0,sqm:0,sqyd:0};if(e.enable_set_price&&h(e.set_price_override)>0)return{total:h(e.set_price_override),sqm:0,sqyd:0};const n=h(e.width_m),s=h(e.height_m),o=h(e.price_sqyd);if(n<=0||s<=0||o<=0)return{total:0,sqm:0,sqyd:0};const a=n*s;let r=a*Vt;r<1?r=1:r=Math.ceil(r*2)/2;const c=r*o;return{total:Math.round(c*100)/100,sqm:a,sqyd:r}},calculateWallpaperPrice:function(e){if(!e||e.is_suspended)return{total:0,material:0,install:0,rolls:0,sqm:0};if(e.enable_set_price&&h(e.set_price_override)>0)return{total:h(e.set_price_override),material:0,install:0,rolls:0,sqm:0};const n=e.widths?.reduce((d,i)=>d+h(i),0)||0;if(n<=0)return{total:0,material:0,install:0,rolls:0,sqm:0};const s=h(e.height_m),o=this.wallpaperRolls(n,s),a=o*h(e.price_per_roll);let r=300;const c=e.install_cost_per_roll;c===0?r=0:typeof c=="number"&&c>0?r=c:h(c)>0&&(r=h(c));const t=o*r,l=a+t;return{total:Math.round(l*100)/100,material:Math.round(a*100)/100,install:Math.round(t*100)/100,rolls:o,sqm:n*s}}},z=Object.entries(W).reduce((e,[n,s])=>(e[n]=s.name,e),{});z.set_louis="‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå";function me(e){const{width:n=0,height:s=0}=e,o=15,a=100-o*2,r=100-o*2,c=n>0&&s>0?Math.min(a/n,r/s):1,t=n*c,l=s*c,d=(100-t)/2,i=(100-l)/2,f=`
        <line x1="${d}" y1="${i+l+5}" x2="${d+t}" y2="${i+l+5}" class="dimension-line" />
        <line x1="${d}" y1="${i+l+3}" x2="${d}" y2="${i+l+7}" class="dimension-tick" />
        <line x1="${d+t}" y1="${i+l+3}" x2="${d+t}" y2="${i+l+7}" class="dimension-tick" />
        <text x="50" y="${i+l+14}" class="dimension-text">${n.toFixed(2)} ‡∏°.</text>

        <line x1="${d-5}" y1="${i}" x2="${d-5}" y2="${i+l}" class="dimension-line" />
        <line x1="${d-7}" y1="${i}" x2="${d-3}" y2="${i}" class="dimension-tick" />
        <line x1="${d-7}" y1="${i+l}" x2="${d-3}" y2="${i+l}" class="dimension-tick" />
        <text x="${d-9}" y="50" class="dimension-text" transform="rotate(-90, ${d-9}, 50)">${s.toFixed(2)} ‡∏°.</text>
    `;return{x:d,y:i,svgWidth:t,svgHeight:l,lines:f}}function kt(e,{y:n,svgHeight:s}){if(!e.opening_style||e.opening_style==="‡∏™‡πÑ‡∏•‡∏î‡πå‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß"||e.type==="set"&&e.style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö")return"";const o=e.opening_style==="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"?"< >":"‚Üí";return`
        <rect x="40" y="${n+s/2-8}" width="20" height="16" rx="3" class="opening-text-bg" />
        <text x="50" y="${n+s/2+1}" class="opening-text">${o}</text>
    `}function Ge(e,{x:n,y:s,svgWidth:o}){if(!e.adjustment_side)return"";const r=e.adjustment_side==="‡∏õ‡∏£‡∏±‡∏ö‡∏ã‡πâ‡∏≤‡∏¢"?n+8:n+o-8;return`
        <g class="adjustment-cord">
            <circle cx="${r}" cy="${s+3}" r="2"/>
            <line x1="${r}" y1="${s+5}" x2="${r}" y2="${s+15}"/>
        </g>
    `}function zt(e){const n=h(e.width_m),s=h(e.height_m);if(n<=0||s<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:a,svgWidth:r,svgHeight:c,lines:t}=me({width:n,height:s});let l="";const d=e.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á"),i=e.fabric_variant.includes("‡∏ó‡∏∂‡∏ö"),f=(b,p)=>(e.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á")==="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"?`
                <rect x="${o}" y="${a+p}" width="${r/2-1}" height="${c}" class="${b}" />
                <rect x="${o+r/2+1}" y="${a+p}" width="${r/2-1}" height="${c}" class="${b}" />
            `:`<rect x="${o}" y="${a+p}" width="${r}" height="${c}" class="${b}" />`;d&&(l+=f("curtain-panel-sheer",0)),i&&(l+=f("curtain-panel-opaque",d?-2:0));let u="";if(e.style==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"){const b=F.calculateGrommets(e)/((e.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á")==="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"?2:1),p=Math.min(Math.floor(b),Math.max(8,Math.floor(r/8)));for(let y=0;y<p;y++){const v=o+r/(p>1?p-1:1)*y;u+=`<circle cx="${v}" cy="${a+2}" r="2" class="style-grommet" />`}}else if(e.style==="‡∏•‡∏≠‡∏ô"){const b=Math.max(4,Math.floor(r/10));let p=`M ${o},${a}`;for(let y=0;y<b;y++)p+=" q 5,-4 10,0";u=`<path d="${p}" class="style-ripplefold-path" />`}else e.style==="‡∏à‡∏µ‡∏ö"&&(u=`<text x="${o+2}" y="${a+5}" class="style-pleat-text">||| ||| ||| ||| |||</text>`);const m=kt(e,{y:a,svgHeight:c});return`<svg viewBox="0 0 100 100">${l}${u}${m}${t}</svg>`}function Zt(e){const n=h(e.width_m),s=h(e.height_m);if(n<=0||s<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:a,svgWidth:r,svgHeight:c,lines:t}=me({width:n,height:s});let l="";const d=e.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á"),i=e.fabric_variant.includes("‡∏ó‡∏∂‡∏ö"),f=(y,v)=>`
        <rect x="${o}" y="${a+v}" width="${r/2-1}" height="${c}" class="${y}" />
        <rect x="${o+r/2+1}" y="${a+v}" width="${r/2-1}" height="${c}" class="${y}" />
    `;d&&(l+=f("curtain-panel-sheer",0)),i&&(l+=f("curtain-panel-opaque",d?-2:0));const u=Math.max(3,Math.floor(r/15)),m=r/u;let b="";for(let y=0;y<u;y++){const v=o+y*m;b+=`<path d="M ${v},${a} Q ${v+m/2},${a+10} ${v+m},${a}" class="louis-swag" />`}b+=`
        <polygon points="${o},${a} ${o+8},${a} ${o},${a+15}" class="louis-tail" />
        <polygon points="${o+r},${a} ${o+r-8},${a} ${o+r},${a+15}" class="louis-tail" />
    `;let p="";if(e.louis_tassels&&e.louis_tassels!=="‡πÑ‡∏°‡πà‡∏°‡∏µ"){p+=`<circle cx="${o+5}" cy="${a+18}" r="2" class="louis-tassel" />`,p+=`<circle cx="${o+r-5}" cy="${a+18}" r="2" class="louis-tassel" />`;for(let y=1;y<u;y++)p+=`<circle cx="${o+y*m}" cy="${a+8}" r="2" class="louis-tassel" />`}return`<svg viewBox="0 0 100 100">${l}${b}${p}${t}</svg>`}function eo(e){const n=h(e.width_m),s=h(e.height_m);if(n<=0||s<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:a,svgWidth:r,svgHeight:c,lines:t}=me({width:n,height:s});let l=`<rect x="${o}" y="${a}" width="${r}" height="${c}" class="blind-frame" />`;const d=5,i=c/d;for(let u=0;u<d;u++)l+=`<rect x="${o+1}" y="${a+u*i}" width="${r-2}" height="${i-1.5}" class="blind-slat" />`;const f=Ge(e,{x:o,y:a,svgWidth:r});return`<svg viewBox="0 0 100 100">${l}${t}${f}</svg>`}function to(e){const n=h(e.width_m),s=h(e.height_m);if(n<=0||s<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:a,svgWidth:r,svgHeight:c,lines:t}=me({width:n,height:s});let l="";const d=e.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á"),f=e.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")?"curtain-panel-opaque":d?"curtain-panel-sheer":"blind-slat";l+=`<rect x="${o}" y="${a}" width="${r}" height="${c}" class="${f}" />`;const u=3;l+=`<line x1="${o}" y1="${a+u/2}" x2="${o+r}" y2="${a+u/2}" class="style-pleat-line" stroke-width="0.8"/>`,l+=`<line x1="${o}" y1="${a+u}" x2="${o+r}" y2="${a+u}" class="style-pleat-line"/>`,l+=`<line x1="${o}" y1="${a+c-u}" x2="${o+r}" y2="${a+c-u}" class="style-pleat-line"/>`,l+=`<line x1="${o}" y1="${a+c-u/2}" x2="${o+r}" y2="${a+c-u/2}" class="style-pleat-line" stroke-width="0.8"/>`;const m=Math.max(8,Math.floor(r/4));for(let y=1;y<m;y++){const v=o+r/m*y;l+=`<line x1="${v}" y1="${a+u}" x2="${v}" y2="${a+c-u}" class="style-pleat-line" opacity="0.5"/>`}const b=a+c*.5,p=8;return l+=`<rect x="${o+r*.1}" y="${b-p/2}" width="${r*.8}" height="${p}" rx="2" class="blind-slat" filter="brightness(0.95)" />`,l+=`<rect x="${o+r*.12}" y="${b-p/2+1.5}" width="${r*.76}" height="${p-3}" rx="1" class="blind-frame" opacity="0.3" />`,`<svg viewBox="0 0 100 100">${l}${t}</svg>`}function ft(e,n=!1){const s=h(e.width_m),o=h(e.height_m);if(s<=0||o<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:a,y:r,svgWidth:c,svgHeight:t,lines:l}=me({width:s,height:o});let d=`<rect x="${a}" y="${r}" width="${c}" height="${t}" class="blind-frame" />`;if(n){const f=Math.max(4,Math.floor(c/8)),u=c/f;for(let m=0;m<f;m++)d+=`<rect x="${a+m*u+1}" y="${r}" width="${u-2}" height="${t}" class="blind-slat" />`}else{const f=Math.max(3,Math.floor(t/6)),u=t/f;for(let m=0;m<f;m++)d+=`<rect x="${a+1}" y="${r+m*u+.5}" width="${c-2}" height="${u-1}" class="blind-slat" />`}const i=Ge(e,{x:a,y:r,svgWidth:c});return`<svg viewBox="0 0 100 100">${d}${l}${i}</svg>`}function oo(e){const n=h(e.width_m),s=h(e.height_m);if(n<=0||s<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:a,svgWidth:r,svgHeight:c,lines:t}=me({width:n,height:s});let l=`<rect x="${o}" y="${a}" width="${r}" height="${c}" class="blind-frame" />`;const d=Math.max(3,Math.floor(c/8)),i=c/d;for(let y=0;y<d;y++)l+=`<rect x="${o+1}" y="${a+y*i}" width="${r-2}" height="${i-1.5}" rx="0.5" class="wooden-blind-slat" />`;const f=Math.max(2,r*.05),u=o+r*.25-f/2,m=o+r*.75-f/2,b=`
        <rect x="${u}" y="${a}" width="${f}" height="${c}" class="wooden-blind-strip" />
        <rect x="${m}" y="${a}" width="${f}" height="${c}" class="wooden-blind-strip" />
    `,p=Ge(e,{x:o,y:a,svgWidth:r});return`<svg viewBox="0 0 100 100">${l}${b}${t}${p}</svg>`}function ao(e){const n=h(e.width_m),s=h(e.height_m);if(n<=0||s<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:a,svgWidth:r,svgHeight:c,lines:t}=me({width:n,height:s}),l=`
        <rect x="${o}" y="${a}" width="${r}" height="${c}" class="roller-fabric" />
        <rect x="${o-1}" y="${a-4}" width="${r+2}" height="5" rx="2" class="roller-roll" />
        <line x1="${o}" y1="${a+c}" x2="${o+r}" y2="${a+c}" class="roller-bar" />
    `,d=Ge(e,{x:o,y:a-2,svgWidth:r});return`<svg viewBox="0 0 100 100">${l}${t}${d}</svg>`}function mt(e,n=!1){const s=h(e.width_m),o=h(e.height_m);if(s<=0||o<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:a,y:r,svgWidth:c,svgHeight:t,lines:l}=me({width:s,height:o});let d="";if(n)d=`
            <defs>
                <pattern id="pleated-mesh" width="6" height="6" patternUnits="userSpaceOnUse">
                    <path d="M -1 1 L 1 -1 M 0 6 L 6 0" class="pleated-screen-mesh" />
                </pattern>
            </defs>
            <rect x="${a}" y="${r}" width="${c}" height="${t}" class="blind-frame" />
            <rect x="${a}" y="${r}" width="${c}" height="${t}" fill="url(#pleated-mesh)" />
        `;else{const f=Math.max(4,Math.floor(c/10)),u=c/f;for(let m=0;m<f;m++)d+=`<rect x="${a+m*u}" y="${r}" width="${u}" height="${t}" class="partition-panel" />`,m>0&&(d+=`<line x1="${a+m*u}" y1="${r}" x2="${a+m*u}" y2="${r+t}" class="partition-hinge" />`)}const i=kt(e,{y:r,svgHeight:t});return`<svg viewBox="0 0 100 100">${d}${i}${l}</svg>`}function no(e){const n=(e.widths||[]).reduce((u,m)=>u+h(m),0),s=h(e.height_m);if(n<=0||s<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:a,svgWidth:r,svgHeight:c,lines:t}=me({width:n,height:s});let l="";const d=Math.floor(r/10),i=Math.floor(c/10);for(let u=0;u<i;u++)for(let m=0;m<d;m++)l+=`<circle cx="${o+m*10+5}" cy="${a+u*10+5}" r="1.5" class="wallpaper-pattern" />`;return`<svg viewBox="0 0 100 100">${`<rect x="${o}" y="${a}" width="${r}" height="${c}" class="blind-frame" /> ${l}`}${t}</svg>`}function ro(e,n,s){let o="",a=z[e.type]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";switch(e.type){case"set":e.style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"?o=eo(e):e.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(o=Zt(e),a=z.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"):e.style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"?o=to(e):o=zt(e);break;case"wooden_blind":o=oo(e);break;case"aluminum_blind":o=ft(e,!1);break;case"vertical_blind":o=ft(e,!0);break;case"roller_blind":o=ao(e);break;case"partition":o=mt(e,!1);break;case"pleated_screen":o=mt(e,!0);break;case"wallpaper":o=no(e);break;default:o=`<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">${C(a)}</text></svg>`;break}return`<div class="visual-placeholder is-clickable"
                 data-act="jump-to-item"
                 data-room-id="${n}"
                 data-item-index="${s}"
                 title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ">${o}</div>`}function ht(e){let n=`
üìÉ *‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤*
`,s=!1;return e.rooms.forEach(o=>{if(o.is_suspended||!o.items)return;const a=o.items.filter(c=>c.is_suspended?!1:c.type==="wallpaper"?(c.widths||[]).reduce((t,l)=>t+h(l),0)>0:(c.type==="set"||W[c.type]?.templateId==="#areaBasedTpl")&&c.type==="removal"?h(c.width_m)>0:!0);if(a.length===0)return;s=!0,n+=`
*üö™ ‡∏´‡πâ‡∏≠‡∏á: ${o.room_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}*
`;let r=0;a.forEach(c=>{r++;let t=z[c.type]||"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";c.type==="set"?c.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(t=z.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",n+=` ${r}) ${t} (${c.fabric_variant||""})
`):n+=` ${r}) ${t} ${c.style||""} (${c.fabric_variant||""})
`:(n+=` ${r}) ${t}`,c.type==="removal"&&(n+=` (${h(c.quantity)} ‡∏ä‡∏∏‡∏î)`),n+=`
`),c.notes&&(n+=`  > _${C(c.notes)}_
`)})}),s?n+`------------------------------
`:""}function xt(e){return e.rooms.reduce((n,s)=>{if(s.is_suspended)return n;const o=s.items?.reduce((a,r)=>{if(r.is_suspended)return a;switch(r.type){case"set":return a+F.calculateSetPrice(r).total;case"wallpaper":return a+F.calculateWallpaperPrice(r).total;case"removal":return a+F.calculateRemovalPrice(r).total;default:return W[r.type]?.templateId==="#areaBasedTpl"?a+F.calculateAreaBasedPrice(r).total:a}},0)||0;return n+o},0)}function so(e,n){const s=Be(),o=xt(e);let a=0,r="";e.discount&&e.discount.value>0&&(e.discount.type==="percent"?(a=o*(e.discount.value/100),r=`üè∑Ô∏è ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (${e.discount.value}%): -${E(a)} ‡∏ö‡∏≤‡∏ó
`):(a=e.discount.value,r=`üè∑Ô∏è ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: -${E(a)} ‡∏ö‡∏≤‡∏ó
`));const c=o-a;let t=`üóìÔ∏è ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (${new Date().toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"2-digit"})})
`;switch(t+=`üë§ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${e.customer_name||"-"}
`,(n==="customer"||n==="owner")&&(t+=`üìû ‡πÇ‡∏ó‡∏£: ${e.customer_phone||"-"}
`,t+=`üè† ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${e.customer_address||"-"}
`),t+=`------------------------------
`,n){case"customer":return t+=ht(e),a>0&&(t+=`
‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${E(o)} ‡∏ö‡∏≤‡∏ó
`,t+=r),t+=`
üí∞ *‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${E(c)} ‡∏ö‡∏≤‡∏ó*
`,t+=`
‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏∞
${s.name}
‡πÇ‡∏ó‡∏£: ${s.phone}`,t;case"purchase_order":case"owner":{n==="owner"&&(t+=ht(e));const l={opaqueFabrics:[],sheerFabrics:[],wallpapers:[],removals:[],allSets:[]};e.rooms.forEach(S=>{S.is_suspended||!S.items||S.items.forEach(w=>{let D=!w.is_suspended;if(w.type==="set"||W[w.type]?.templateId==="#areaBasedTpl")D=D&&h(w.width_m)>0&&h(w.height_m)>0;else if(w.type==="wallpaper"){const I=(w.widths||[]).reduce((g,M)=>g+h(M),0);D=D&&I>0&&h(w.height_m)>0}if(D)switch(w.type){case"set":l.allSets.push(w),w.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&l.opaqueFabrics.push({code:w.fabric_code||"??",yards:F.fabricYardage(w.style,w.width_m),notes:w.notes}),w.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&l.sheerFabrics.push({code:w.sheer_fabric_code||"??",yards:F.fabricYardage(w.style,w.width_m),notes:w.notes});break;case"wallpaper":const I=(w.widths||[]).reduce((M,T)=>M+h(T),0),g=F.wallpaperRolls(I,w.height_m);g>0&&l.wallpapers.push({code:w.wallpaper_code||"xxx",rolls:g,notes:w.notes});break;case"removal":l.removals.push({...w,total:F.calculateRemovalPrice(w).total});break;default:if(W[w.type]?.templateId==="#areaBasedTpl"){const M=w.type;l[M]||(l[M]=[]),l[M].push({code:w.code||"xxx",width:h(w.width_m),height:h(w.height_m),opening_style:w.opening_style,adjustment_side:w.adjustment_side,notes:w.notes})}break}})});const d={};if([...l.opaqueFabrics,...l.sheerFabrics].forEach(S=>{S.yards>0&&(d[S.code]=(d[S.code]||0)+S.yards)}),Object.keys(d).length>0){t+=`‚úÇÔ∏è *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ú‡πâ‡∏≤)*
`,t+=`------------------------------
`,l.opaqueFabrics.filter(S=>S.yards>0).forEach((S,w)=>{t+=`- ‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö (Curtain) #${w+1}
`,t+=`  ‡∏£‡∏´‡∏±‡∏™: #${S.code||"??"}
`,t+=`  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${S.yards.toFixed(2)} ‡∏´‡∏•‡∏≤
`,S.notes&&(t+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${S.notes}
`),t+=`
`}),l.sheerFabrics.filter(S=>S.yards>0).forEach((S,w)=>{t+=`- ‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á (Sheer) #${w+1}
`,t+=`  ‡∏£‡∏´‡∏±‡∏™: #${S.code||"??"}
`,t+=`  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${S.yards.toFixed(2)} ‡∏´‡∏•‡∏≤
`,S.notes&&(t+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${S.notes}
`),t+=`
`}),t+=`------------------------------
`,t+=`üìä *‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ú‡πâ‡∏≤ (‡∏ï‡∏≤‡∏°‡∏£‡∏´‡∏±‡∏™)*
`,t+=`------------------------------
`;for(const[S,w]of Object.entries(d))t+=`  - ‡∏£‡∏´‡∏±‡∏™ #${S}: ${w.toFixed(2)} ‡∏´‡∏•‡∏≤
`;t+=`
`}const i=l.allSets.filter(S=>S.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"),f=l.allSets.filter(S=>S.style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"),u=l.allSets.filter(S=>S.style==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"),m=l.allSets.filter(S=>S.style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"),b=l.allSets.filter(S=>!["‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö","‡∏ï‡∏≤‡πÑ‡∏Å‡πà","‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå","‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"].includes(S.style));if(i.length>0){t+=`------------------------------
`,t+=`üëë *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á (‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå)*
`,t+=`------------------------------

`;let S=1;i.forEach(g=>{t+=`(${S++}) ‡∏£‡∏≤‡∏á ${g.style}, ‡∏™‡∏µ: ${g.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,t+=`  - ‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å (‡∏ó‡∏∂‡∏ö/‡πÇ‡∏õ‡∏£‡πà‡∏á): ${Number(g.width_m).toFixed(2)} ‡∏°.
`,t+=`  - ‡∏´‡∏±‡∏ß‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå: ${g.louis_valance||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"}
`,t+=`  - ‡∏û‡∏π‡πà: ${g.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤"}
`,g.notes&&(t+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${g.notes}
`),t+=`
`});const w=[];i.forEach(g=>{w.push(Number(g.width_m)),g.fabric_variant==="‡∏ó‡∏∂‡∏ö&‡πÇ‡∏õ‡∏£‡πà‡∏á"&&w.push(Number(g.width_m))});const D=w.reduce((g,M)=>{const T=M.toFixed(2);return g[T]=(g[T]||0)+1,g},{}),I=Object.entries(D).sort((g,M)=>parseFloat(M[0])-parseFloat(g[0]));if(I.length>0){t+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå ---
`,t+=`*‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î (‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì):*
`;for(const[g,M]of I)t+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${g} ‡∏°. = ${M} ‡πÄ‡∏™‡πâ‡∏ô
`;t+=`
`}}if(f.length>0){t+=`------------------------------
`,t+=`üìè *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö*
`,t+=`------------------------------

`;let S=1;f.forEach(I=>{t+=`(${S++}) ‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö
`,t+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î: ${Number(I.width_m).toFixed(2)} ‡∏°.
`,t+=`  - ‡∏™‡∏µ‡∏£‡∏≤‡∏á: ${I.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,t+=`  - ‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏±‡∏ö: ${I.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤"}
`,I.notes&&(t+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${I.notes}
`),t+=`
`});const w=f.reduce((I,g)=>{const M=Number(g.width_m).toFixed(2);return I[M]=(I[M]||0)+1,I},{}),D=Object.entries(w).sort((I,g)=>parseFloat(g[0])-parseFloat(I[0]));if(D.length>0){t+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö ---
`,t+=`*‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î:*
`;for(const[I,g]of D)t+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${I} ‡∏°. = ${g} ‡πÄ‡∏™‡πâ‡∏ô
`;t+=`
`}}if(b.length>0){t+=`------------------------------
`,t+=`üìè *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á (‡∏•‡∏≠‡∏ô/‡∏à‡∏µ‡∏ö)*
`,t+=`------------------------------

`;let S=1;b.forEach(g=>{t+=`(${S++}) ‡∏£‡∏≤‡∏á ${g.style}, ‡∏™‡∏µ: ${g.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,g.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(t+=`  - ‡∏£‡∏≤‡∏á‡∏ó‡∏∂‡∏ö: ${Number(g.width_m).toFixed(2)} ‡∏°.
`),g.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(t+=`  - ‡∏£‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πà‡∏á: ${Number(g.width_m).toFixed(2)} ‡∏°.
`),g.notes&&(t+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${g.notes}
`),t+=`
`});const w=[];b.forEach(g=>{g.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&w.push(Number(g.width_m)),g.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&w.push(Number(g.width_m))});const D=w.reduce((g,M)=>{const T=M.toFixed(2);return g[T]=(g[T]||0)+1,g},{}),I=Object.entries(D).sort((g,M)=>parseFloat(M[0])-parseFloat(g[0]));if(I.length>0){t+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏•‡∏≠‡∏ô/‡∏à‡∏µ‡∏ö ---
`,t+=`*‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î:*
`;for(const[g,M]of I)t+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${g} ‡∏°. = ${M} ‡πÄ‡∏™‡πâ‡∏ô
`;t+=`
`}}if(u.length>0){t+=`------------------------------
`,t+=`üìè *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á (‡∏ï‡∏≤‡πÑ‡∏Å‡πà)*
`,t+=`------------------------------

`;let S=1;u.forEach(T=>{t+=`(${S++}) ‡∏£‡∏≤‡∏á ${T.style}, ‡∏™‡∏µ: ${T.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,T.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(t+=`  - ‡∏£‡∏≤‡∏á‡∏ó‡∏∂‡∏ö: ${Number(T.width_m).toFixed(2)} ‡∏°.
`),T.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(t+=`  - ‡∏£‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πà‡∏á: ${Number(T.width_m).toFixed(2)} ‡∏°.
`),T.notes&&(t+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${T.notes}
`),t+=`
`}),t+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏ï‡∏≤‡πÑ‡∏Å‡πà ---
`;const w=[];u.forEach(T=>{T.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&w.push(Number(T.width_m)),T.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&w.push(Number(T.width_m))});const D=6;w.sort((T,$)=>$-T);const I=[];for(const T of w){let $=!1;for(let N=0;N<I.length;N++)if(I[N]>=T-.001){I[N]-=T,$=!0;break}$||I.push(D-T)}t+=`‡πÉ‡∏ä‡πâ‡∏£‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏° (6 ‡∏°.) ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: *${I.length} ‡πÄ‡∏™‡πâ‡∏ô*

`;const g=w.reduce((T,$)=>{const N=$.toFixed(2);return T[N]=(T[N]||0)+1,T},{}),M=Object.entries(g).sort((T,$)=>parseFloat($[0])-parseFloat(T[0]));if(M.length>0){t+=`*‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î:*
`;for(const[T,$]of M)t+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${T} ‡∏°. = ${$} ‡πÄ‡∏™‡πâ‡∏ô
`;t+=`
`}}if(m.length>0){t+=`------------------------------
`,t+=`üìè *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á (‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö)*
`,t+=`------------------------------

`;let S=1;m.forEach(g=>{t+=`(${S++}) ‡∏£‡∏≤‡∏á ${g.style}, ‡∏™‡∏µ: ${g.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,t+=`  - ‡∏£‡∏≤‡∏á: ${Number(g.width_m).toFixed(2)} ‡∏°.
`,g.notes&&(t+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${g.notes}
`),t+=`
`});const D=m.map(g=>Number(g.width_m)).reduce((g,M)=>{const T=M.toFixed(2);return g[T]=(g[T]||0)+1,g},{}),I=Object.entries(D).sort((g,M)=>parseFloat(M[0])-parseFloat(g[0]));if(I.length>0){t+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö ---
`,t+=`*‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î:*
`;for(const[g,M]of I)t+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${g} ‡∏°. = ${M} ‡πÄ‡∏™‡πâ‡∏ô
`;t+=`
`}}const p={};let y={};l.allSets.forEach(S=>{const w=S.track_color||"‡∏Ç‡∏≤‡∏ß",D=h(S.width_m),I=S.style,g=S.fabric_variant==="‡∏ó‡∏∂‡∏ö&‡πÇ‡∏õ‡∏£‡πà‡∏á";let M=0;if(I==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"?M=D>=1.6?3:2:(I==="‡∏•‡∏≠‡∏ô"||I==="‡∏à‡∏µ‡∏ö")&&(M=Math.round(D/.8)+1),p[w]||(p[w]={brackets:{},finials:0,grommets:{},rodPocketBrackets:0}),p[w].brackets[I]||(p[w].brackets[I]={single:0,double:0}),M>0?g?p[w].brackets[I].double+=M:p[w].brackets[I].single+=M:I==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"&&(p[w].rodPocketBrackets+=4),I==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"){const T=g?4:2;p[w].finials+=T}if(I==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"){const T=S.grommet_color||"‡πÄ‡∏á‡∏¥‡∏ô",$=F.calculateGrommets(S);p[w].grommets[T]||(p[w].grommets[T]=0),p[w].grommets[T]+=$}if(I==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"){const T=S.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤";T!=="‡πÑ‡∏°‡πà‡∏°‡∏µ"&&(y[T]=(y[T]||0)+2)}});const v=l.allSets.filter(S=>!["‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö","‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå","‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"].includes(S.style)).length*2,k=Object.values(p).some(S=>Object.values(S.brackets).some(w=>w.single>0||w.double>0)),L=Object.values(p).some(S=>S.rodPocketBrackets>0),B=Object.values(p).some(S=>S.finials>0),R=Object.values(p).some(S=>Object.values(S.grommets).some(w=>w>0)),x=Object.keys(y).length>0;if(k||L||B||R||v>0||x){t+=`------------------------------
`,t+=`üî© *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (Hardware)*
`,t+=`------------------------------

`;for(const[w,D]of Object.entries(p)){let I=!1,g=`**‡∏™‡∏µ${w}**
`;const M=Object.keys(D.brackets);if(M.length>0){let $="";M.forEach(N=>{!["‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö","‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå","‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"].includes(N)&&(D.brackets[N].single>0||D.brackets[N].double>0)&&($+=`    - ${N} (‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß): ${D.brackets[N].single} ‡∏ï‡∏±‡∏ß
`,$+=`    - ${N} (2‡∏ä‡∏±‡πâ‡∏ô): ${D.brackets[N].double} ‡∏ï‡∏±‡∏ß
`)}),$&&(I=!0,g+=`  - ‡∏Ç‡∏≤‡∏à‡∏±‡∏ö (‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô):
${$}`)}D.rodPocketBrackets>0&&(I=!0,g+=`  - ‡∏Ç‡∏≤‡∏à‡∏±‡∏ö (‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö): ${D.rodPocketBrackets} ‡∏ï‡∏±‡∏ß
`),D.finials>0&&(I=!0,g+=`  - ‡∏´‡∏±‡∏ß‡∏£‡∏≤‡∏á (‡∏ï‡∏≤‡πÑ‡∏Å‡πà): ${D.finials} ‡∏ï‡∏±‡∏ß
`);const T=Object.keys(D.grommets);if(T.length>0){let $="";T.forEach(N=>{const G=D.grommets[N];G>0&&($+=`    - ‡∏™‡∏µ${N}: ${G} ‡∏ï‡∏±‡∏ß
`)}),$&&(I=!0,g+=`  - ‡∏ï‡∏≤‡πÑ‡∏Å‡πà:
${$}`)}I&&(t+=g+`
`)}let S="";if(v>0&&(S+=`  - ‡∏ï‡∏∞‡∏Ç‡∏≠‡∏£‡∏ß‡∏ö‡∏°‡πà‡∏≤‡∏ô (‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô): ${v} ‡∏ï‡∏±‡∏ß
`),x){S+=`  - ‡∏û‡∏π‡πà/‡∏™‡∏≤‡∏¢‡∏£‡∏ß‡∏ö (‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå):
`;for(const[w,D]of Object.entries(y))S+=`    - ${w}: ${D} ‡∏ä‡∏∏‡∏î
`}S&&(t+=`**‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏ß‡∏°**
`+S+`
`)}const j=Object.keys(l).filter(S=>!["opaqueFabrics","sheerFabrics","wallpapers","removals","allSets"].includes(S));j.length>0&&j.sort().forEach(S=>{const w=l[S],D=z[S]||S;t+=`------------------------------
`,t+=`üì¶ *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ${D}*
`,t+=`------------------------------

`,w.forEach(I=>{t+=`- ‡∏£‡∏´‡∏±‡∏™: #${I.code||"xxx"}
  ‡∏Ç‡∏ô‡∏≤‡∏î: ${I.width.toFixed(2)} x ${I.height.toFixed(2)} ‡∏°.
`,I.opening_style&&(t+=`  ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î: ${I.opening_style}
`),I.adjustment_side&&(t+=`  ‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏±‡∏ö: ${I.adjustment_side}
`),I.notes&&(t+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${I.notes}
`),t+=`
`})});const H={};if(l.wallpapers.forEach(S=>{H[S.code]=(H[S.code]||0)+S.rolls}),Object.keys(H).length>0&&(t+=`------------------------------
`,t+=`üé® *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (Wallpaper)*
`,t+=`------------------------------

`,l.wallpapers.forEach((S,w)=>{t+=`  - ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ #${w+1}
`,t+=`    ‡∏£‡∏´‡∏±‡∏™: #${S.code||"xxx"}
`,t+=`    ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${S.rolls} ‡∏°‡πâ‡∏ß‡∏ô
`,S.notes&&(t+=`    üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${S.notes}
`),t+=`
`}),Object.keys(H).length>1)){t+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ß‡∏≠‡∏•‡∏•‡πå ---
`;for(const[S,w]of Object.entries(H))t+=`  - ‡∏£‡∏´‡∏±‡∏™ #${S}: ${w} ‡∏°‡πâ‡∏ß‡∏ô
`;t+=`
`}if(l.removals.length>0&&(t+=`------------------------------
`,t+=`üì¶ *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏∑‡πâ‡∏≠‡∏ñ‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤*
`,t+=`------------------------------

`,l.removals.forEach((S,w)=>{t+=`  - ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ #${w+1}: ${C(S.description)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}
`,t+=`    ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${h(S.quantity)} ‡∏ä‡∏∏‡∏î
`,t+=`    ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏´‡∏°‡∏≤: ${E(S.total)} ‡∏ö‡∏≤‡∏ó
`,S.notes&&(t+=`    üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${S.notes}
`),t+=`
`})),n==="purchase_order")return t+=`------------------------------
`,t}break}if(n==="seamstress"||n==="owner"){t+=`
üßµ *‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏¢‡πá‡∏ö‡∏ú‡πâ‡∏≤*
`;let l=0;if(e.rooms.forEach(d=>{if(d.is_suspended||!d.items)return;const i=d.items.filter(f=>f.type==="set"&&!f.is_suspended&&h(f.width_m)>0&&h(f.height_m)>0);i.length!==0&&(l>0&&(t+=`==============================
`),t+=`
*üö™ ‡∏´‡πâ‡∏≠‡∏á: ${d.room_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}*

`,i.forEach((f,u)=>{u>0&&(t+=`--------------------
`);const m=f.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?z.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå":f.style;t+=`*‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà ${u+1}/${i.length}: ${m} ${f.fabric_variant}*
`,f.style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"?t+=`  - ‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏±‡∏ö: ${f.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤"}
`:f.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(t+=`  - ‡∏´‡∏±‡∏ß‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå: ${f.louis_valance||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"}
`,t+=`  - ‡∏û‡∏π‡πà: ${f.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤"}
`):f.style!=="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"&&(t+=`  - ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î: ${f.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"}
`),f.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(f.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(t+=`  - ‡∏ú‡πâ‡∏≤‡∏ê‡∏≤‡∏ô (‡∏ó‡∏∂‡∏ö): #${f.fabric_code||"-"}
`),f.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(t+=`  - ‡∏ú‡πâ‡∏≤‡∏ê‡∏≤‡∏ô (‡πÇ‡∏õ‡∏£‡πà‡∏á): #${f.sheer_fabric_code||"-"}
`)):(f.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(t+=`  - ‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö: #${f.fabric_code||"-"}
`),f.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(t+=`  - ‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á: #${f.sheer_fabric_code||"-"}
`)),t+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î: ‡∏Å‡∏ß‡πâ‡∏≤‡∏á ${Number(f.width_m).toFixed(2)} x ‡∏™‡∏π‡∏á ${Number(f.height_m).toFixed(2)} ‡∏°.
`,f.notes&&(t+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${f.notes}
`)}),t+=`
`,l++)}),l>0?t+=`==============================
`:t+=`‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á
------------------------------
`,n==="seamstress")return t}return n==="owner"&&(t+=`
üí∞ *‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${E(c)} ‡∏ö‡∏≤‡∏ó*
`,a>0&&(t+=`   (‡∏¢‡∏≠‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏î: ${E(o)} ‡∏ö‡∏≤‡∏ó ${r.trim()})
`)),t}function lo(e){if(!e.rooms||e.rooms.length===0)return'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>';let n="";const s={};let o=0;if(e.rooms.forEach(c=>{c.is_suspended||!c.items||c.items.forEach(t=>{if(t.is_suspended)return;let l=null,d=0;switch(t.type){case"set":d=F.calculateSetPrice(t).total,d>0&&(l=t.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?"set_louis":"set");break;case"wallpaper":d=F.calculateWallpaperPrice(t).total,d>0&&(l=t.type);break;case"removal":d=F.calculateRemovalPrice(t).total,d>0&&(l=t.type);break;default:W[t.type]?.templateId==="#areaBasedTpl"&&(d=F.calculateAreaBasedPrice(t).total,d>0&&(l=t.type));break}l&&(s[l]=(s[l]||0)+1,o++)})}),o>0){const c=Object.entries(s).map(([t,l])=>{const d=z[t]||z[t.split("_")[0]]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";return`
                <span class="summary-tag" data-filter-type="${C(t)}" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ">
                    ${C(d)} <strong>${l}</strong>
                </span>`}).join("");c&&(n+=`
                <div class="overview-summary-group">
                    <h4><i class="ph ph-stack"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h4>
                    <div class="summary-tags-container">
                        ${c}
                    </div>
                </div>`)}let a="",r=0;return e.rooms.forEach(c=>{if(c.is_suspended||!c.items)return;const t={};let l=0;if(c.items.forEach(d=>{if(d.is_suspended)return;let i=null,f=0;switch(d.type){case"set":f=F.calculateSetPrice(d).total,f>0&&(i=d.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?"set_louis":"set");break;case"wallpaper":f=F.calculateWallpaperPrice(d).total,f>0&&(i=d.type);break;case"removal":f=F.calculateRemovalPrice(d).total,f>0&&(i=d.type);break;default:W[d.type]?.templateId==="#areaBasedTpl"&&(f=F.calculateAreaBasedPrice(d).total,f>0&&(i=d.type));break}i&&(t[i]=(t[i]||0)+1,l++)}),l>0){r+=l;const d=Object.entries(t).map(([i,f])=>{const u=z[i]||z[i.split("_")[0]]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";return`
                    <div class="overview-item">
                        <span>${C(u)}</span>
                        <span>${f}</span>
                    </div>`}).join("");a+=`
                <details class="overview-room-card">
                    <summary class="overview-room-summary">
                        <span class="room-name">${C(c.room_name)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á"}</span>
                        <div class="summary-tags">
                            <span class="room-item-count">${l} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                            <i class="ph ph-caret-down expand-icon"></i>
                        </div>
                    </summary>
                    <div class="overview-room-items">${d}</div>
                </details>`}}),a&&(n+=`
            <div class="overview-breakdown-group">
                <h4><i class="ph ph-map-pin-line"></i> ‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á</h4>
                ${a}
            </div>`),o===0&&r===0?'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>':n}function co(e,n){let s=0;for(let o=e;o<n.length;o++){const a=n[o];if(o>e&&a.isSpacer)break;s+=a.units}return s}function io(e,n){const s=Be(),{vatRate:o=s.baseVatRate,pageBreakBuffer:a=3,showDetails:r=!0}=n,c=[];e.rooms.forEach(M=>{if(M.is_suspended||!M.items)return;const T=[];if(M.items.forEach($=>{if($.is_suspended)return;let N="",G=0,te=1,A=0,O=1,U=!0,Z=$.type==="set"&&$.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?z.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå":z[$.type]||"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á",Y="";switch($.type){case"set":{if(A=F.calculateSetPrice($).total,G=A,A>0){const ce=h($.width_m),V=h($.height_m),fe=$.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?"":` ${C($.style||"")}`;N=`${Z}${fe} (${C($.fabric_variant||"")})`,r&&(Y=`<br><small>‡∏Ç‡∏ô‡∏≤‡∏î ${ce.toFixed(2)} x ${V.toFixed(2)} ‡∏°.${$.notes?` - ${C($.notes)}`:""}</small>`),O=r?1.5:1}break}case"wallpaper":{if(A=F.calculateWallpaperPrice($).total,G=A,A>0){const ce=($.widths||[]).reduce((Ae,Pe)=>Ae+h(Pe),0),V=F.wallpaperRolls(ce,$.height_m),fe=h($.height_m);N=`${Z}`,r&&(Y=`<br><small>‡∏£‡∏´‡∏±‡∏™: ${C($.wallpaper_code)||"-"}, ‡∏™‡∏π‡∏á ${fe.toFixed(2)} ‡∏°. (‡πÉ‡∏ä‡πâ ${V} ‡∏°‡πâ‡∏ß‡∏ô)${$.notes?` - ${C($.notes)}`:""}</small>`),O=r?1.5:1}break}case"removal":{if(A=F.calculateRemovalPrice($).total,U=!1,A>0){G=h($.price_per_item),te=h($.quantity),Z=z[$.type]||"‡∏£‡∏∑‡πâ‡∏≠‡∏ñ‡∏≠‡∏ô";const V=$.description?` (${C($.description)})`:"";N=`${Z}${V}`,r&&(Y=$.notes?`<br><small>${C($.notes)}</small>`:""),O=r?1.5:1}break}default:{if(W[$.type]?.templateId==="#areaBasedTpl"&&(A=F.calculateAreaBasedPrice($).total,G=A,A>0)){const ce=h($.width_m),V=h($.height_m);N=`${Z}`,r&&(Y=`<br><small>‡∏£‡∏´‡∏±‡∏™: ${C($.code)||"-"}, ‡∏Ç‡∏ô‡∏≤‡∏î ${ce.toFixed(2)} x ${V.toFixed(2)} ‡∏°.${$.notes?` - ${C($.notes)}`:""}</small>`),O=r?1.5:1}break}}A>0&&N&&T.push({description:N+Y,unitPrice:G,quantity:te,total:A,units:O,isGroupable:U})}),T.length>0){c.length>0&&c.push({isSpacer:!0,units:.5}),c.push({isRoomHeader:!0,roomName:C(M.room_name)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á",units:1.2});const $=new Map;T.forEach(N=>{if(N.isGroupable){const G=`${N.description}::${N.unitPrice}`;if($.has(G)){const te=$.get(G);te.quantity+=1,te.total=te.quantity*te.unitPrice}else $.set(G,N),c.push(N)}else c.push(N)})}});const t=c.reduce((M,T)=>M+(T.total||0),0);if(t===0)return null;let l=0,d="",i=t;e.discount&&e.discount.value>0&&(e.discount.type==="percent"?(l=t*(e.discount.value/100),d=`<tr><td class="pdf-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (${e.discount.value}%)</td><td class="pdf-amount">-${ie(l,2,!0)}</td></tr>`):(l=e.discount.value,d=`<tr><td class="pdf-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</td><td class="pdf-amount">-${ie(l,2,!0)}</td></tr>`),i=t-l);const f=i*o,u=i+f,m=r?17:20,b=r?23:28,p=[];let y=[],v=0;c.forEach((M,T)=>{let $=p.length===0?m:b;if(M.isRoomHeader&&v>0){const A=co(T,c),O=$-v,U=A>O,Z=M.units<=O;U&&Z&&(p.push(y),y=[],v=0,$=p.length===0?m:b)}const N=v+M.units>$;let G=!1;if(M.isRoomHeader&&T<c.length-1){const A=c[T+1].units||(r?1.5:1);v+M.units+A>$&&v+M.units<=$&&(G=!0)}let te=!1;if(!N&&!G&&T<c.length-1){const A=$-(v+M.units),O=c[T+1].units||(r?1.5:1);A>0&&A<a&&A<O&&!M.isRoomHeader&&!M.isSpacer&&(te=!0)}(N||G||te)&&y.length>0&&(p.push(y),y=[],v=0),y.push(M),v+=M.units}),y.length>0&&p.push(y);const k=new Date,L=k.toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"}),B=`${k.getFullYear().toString().slice(-2)}${(k.getMonth()+1).toString().padStart(2,"0")}${k.getDate().toString().padStart(2,"0")}`,R=e.customer_name||e.customer_phone||"Customer";let x=0;for(let M=0;M<R.length;M++)x=(x<<5)-x+R.charCodeAt(M),x=x&x;const j=`QT-${Math.abs(x)%9e3+1e3}-${B}`;let H="";if(s.logoUrl)try{H=new URL(s.logoUrl,document.baseURI).href}catch{H=s.logoUrl}let S="",w=0,D=1;p.forEach((M,T)=>{const $=T===0,N=T===p.length-1,G=`
            <div class="pdf-page-header">
                <div class="pdf-header">
                     <div class="pdf-shop-info">
                        ${H?`<img src="${H}" alt="Logo" class="pdf-logo">`:""}
                        <div class="pdf-shop-address">
                            <strong><i class=""></i> ${C(s.name)}</strong><br>
                            ${C(s.address).replace(/\n/g,"<br>")}<br>
							‡πÇ‡∏ó‡∏£: ${C(s.phone)}<br>email: ${C(s.taxId)}
                        </div>
                    </div>
                     <div class="pdf-quote-details">
                        <div class="pdf-title-box"><h1>‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ ${p.length>1?$?"":"(‡∏ï‡πà‡∏≠)":""}</h1></div>
                        <table class="pdf-quote-meta">
                            <tr><td>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</td><td>${j}</td></tr>
                            <tr><td>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</td><td>${L}</td></tr>
                        </table>
                    </div>
                </div>
                ${$?`
                <section class="pdf-customer-details">
                     <div class="pdf-customer-info">
                        <strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${C(e.customer_name)||"-"}<br>
                        <strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${C(e.customer_address||"-").replace(/\n/g,"<br>")}<br>
                        <strong>‡πÇ‡∏ó‡∏£:</strong> ${C(e.customer_phone)||"-"}
                    </div>
                    </section>`:""}
            </div>`,te=`
            <div class="pdf-page-footer">
                <div class="pdf-footer-info">
                    <span><i class=""></i> ${C(s.name)} | ‡πÇ‡∏ó‡∏£: ${C(s.phone)}</span>
                    <span>‡∏´‡∏ô‡πâ‡∏≤ ${T+1} / ${p.length}</span>
                </div>
            </div>`;let A="";$||(A+=`<tr class="pdf-subtotal-row"><td colspan="4">‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡∏°‡∏≤ (Brought Forward)</td><td class="pdf-text-right">${ie(w,2,!0)}</td></tr>`),M.forEach(Y=>{Y.isSpacer?A+='<tr class="pdf-room-spacer" style="page-break-inside: avoid; background: #fff !important;"><td colspan="5" style="border: none; padding: 1.5mm 0 !important; line-height: 1.5mm;">&nbsp;</td></tr>':Y.isRoomHeader?A+=`<tr class="pdf-room-header" style="page-break-after: avoid;"><td colspan="5">‡∏´‡πâ‡∏≠‡∏á: ${Y.roomName}</td></tr>`:(A+=`<tr>
                    <td class="pdf-text-center">${D++}</td>
                    <td>${Y.description}</td>
                    <td class="pdf-text-center">${Y.quantity}</td>
                    <td class="pdf-text-right">${ie(Y.unitPrice,2,!0)}</td>
                    <td class="pdf-text-right">${ie(Y.total,2,!0)}</td>
                </tr>`,w+=Y.total)});let O="";N||(O=`<tfoot><tr class="pdf-subtotal-row"><td colspan="4">‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡πÑ‡∏õ (Carried Forward)</td><td class="pdf-text-right">${ie(w,2,!0)}</td></tr></tfoot>`);let U="";r&&s.pdf.notes&&s.pdf.notes.length>0&&(U=`
                <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong>
                <ul>${s.pdf.notes.map(Y=>`<li>${C(Y)}</li>`).join("")}</ul>
            `);const Z=N?`
            <div class="pdf-summary-wrapper">
                <section class="pdf-summary-section">
                    <div class="pdf-amount-in-words">
                        ${U}
                        <div class="pdf-amount-text">( ${Jt(u)} )</div>
                    </div>
                    <div class="pdf-totals-block">
                        <table>
                            <tr><td class="pdf-label">‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</td><td class="pdf-amount">${ie(t,2,!0)}</td></tr>
                            ${d}
                            ${o>0?`<tr><td class="pdf-label">‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° ${(o*100).toFixed(0)}%</td><td class="pdf-amount">${ie(f,2,!0)}</td></tr>`:""}
                            <tr class="pdf-grand-total"><td class="pdf-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥(‡∏£‡∏ß‡∏°‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°)</td><td class="pdf-amount">${ie(u,2,!0)}</td></tr>
                        </table>
                    </div>
                </section>
                <footer class="pdf-footer-section">
                    <div class="pdf-signature-box"><p>.................................................</p><p>‡∏ô‡∏≤‡∏¢‡∏ó‡∏£‡∏á‡∏ß‡∏∏‡∏í‡∏¥ ‡∏ó‡∏≠‡∏á‡πÑ‡∏û‡∏£</p><p>‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</p><p>(<i class=""></i> ${C(s.name)})</p><p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${L}</p></div>
                    <div class="pdf-signature-box"><p>.................................................</p><p>(.................................................)</p><p>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / ‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡∏•‡∏á‡∏ô‡∏≤‡∏°</p><p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ......./......./............</p></div>
                </footer>
            </div>
        `:"";S+=`
            <div class="pdf-page">
                <div class="pdf-page-content">
                    ${G}
                    <div class="pdf-page-body">
                        <table class="pdf-items-table">
                            <thead><tr><th style="width:5%;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th style="width:45%;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th style="width:10%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th style="width:17.5%;">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th style="width:17.5%;">‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th></tr></thead>
                            <tbody>${A}</tbody>
                            ${O}
                        </table>
                        ${Z}
                    </div>
                    ${te}
                </div>
            </div>`});const I=e.customer_name||"quote",g=$t(I);return{html:`<div id="quotation-template">${S}</div>`,fileName:`${j}_${g}`}}function uo(e){const n=xt(e);let s=0;e.discount?.value>0&&(s=e.discount.type==="percent"?n*(e.discount.value/100):e.discount.value);const o=n-s;let a=!1,r=e.rooms.map(t=>{if(t.is_suspended)return"";const l=t.items.filter(i=>i.is_suspended?!1:i.type==="set"||W[i.type]?.templateId==="#areaBasedTpl"?h(i.width_m)>0&&h(i.height_m)>0:i.type==="wallpaper"?(i.widths||[]).reduce((u,m)=>u+h(m),0)>0&&h(i.height_m)>0:i.type==="removal"?h(i.quantity)>0&&h(i.price_per_item)>0:!1);if(l.length===0)return"";const d=l.map((i,f)=>{let u="",m="",b="",p="";switch(i.type==="set"?i.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(p=z.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",m=`<h5 class="lookbook-item-title">${C(p)}</h5>`):i.style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"?(p=z.set||"‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô",m=`<h5 class="lookbook-item-title">${C(p)} ${C(i.style)}</h5>`):p=z.set||"‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô":(p=z[i.type]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á",m=`<h5 class="lookbook-item-title">${C(p)}</h5>`),i.type){case"set":b=`<tr><td>‡∏Ç‡∏ô‡∏≤‡∏î</td><td>${h(i.width_m).toFixed(2)} x ${h(i.height_m).toFixed(2)} ‡∏°.</td></tr>`,i.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?u=`
                            <tr><td>‡πÅ‡∏ö‡∏ö</td><td>${p} (${C(i.fabric_variant||"")})</td></tr>
                            ${i.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")?`<tr><td>‡∏ú‡πâ‡∏≤‡∏ê‡∏≤‡∏ô</td><td>#${C(i.fabric_code)||"-"}</td></tr>`:""}
                            ${i.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")?`<tr><td>‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á</td><td>#${C(i.sheer_fabric_code)||"-"}</td></tr>`:""}
                            <tr><td>‡∏´‡∏±‡∏ß‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå</td><td>${C(i.louis_valance||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå")}</td></tr>
                            <tr><td>‡∏û‡∏π‡πà</td><td>${C(i.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤")}</td></tr>
                         `:i.style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"?u=`
                             <tr><td>‡πÅ‡∏ö‡∏ö</td><td>${C(i.style)} (${C(i.fabric_variant||"")})</td></tr>
                             ${i.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")?`<tr><td>‡∏ú‡πâ‡∏≤</td><td>#${C(i.fabric_code)||"-"}</td></tr>`:""}
                             ${i.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")?`<tr><td>‡∏ú‡πâ‡∏≤</td><td>#${C(i.sheer_fabric_code)||"-"}</td></tr>`:""}
                         `:(u=`
                            <tr><td>‡πÅ‡∏ö‡∏ö</td><td>${C(i.style||"")} (${C(i.fabric_variant||"")})</td></tr>
                            ${i.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")?`<tr><td>‡∏ó‡∏∂‡∏ö</td><td>#${C(i.fabric_code)||"-"}</td></tr>`:""}
                            ${i.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")?`<tr><td>‡πÇ‡∏õ‡∏£‡πà‡∏á</td><td>#${C(i.sheer_fabric_code)||"-"}</td></tr>`:""}
                        `,i.style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"?u+=`<tr><td>‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å</td><td>${C(i.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤")}</td></tr>`:u+=`<tr><td>‡πÄ‡∏õ‡∏¥‡∏î</td><td>${C(i.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á")}</td></tr>`);break;case"wallpaper":const y=(i.widths||[]).reduce((k,L)=>k+h(L),0),v=F.wallpaperRolls(y,i.height_m);b=`<tr><td>‡∏Ç‡∏ô‡∏≤‡∏î</td><td>‡∏£‡∏ß‡∏° ${y.toFixed(2)} ‡∏°., ‡∏™‡∏π‡∏á ${h(i.height_m).toFixed(2)} ‡∏°.</td></tr>`,u=`
                        <tr><td>‡∏£‡∏´‡∏±‡∏™</td><td>#${C(i.wallpaper_code)||"-"}</td></tr>
                        <tr><td>‡πÉ‡∏ä‡πâ</td><td>${v} ‡∏°‡πâ‡∏ß‡∏ô</td></tr>
                    `;break;case"removal":b=`<tr><td>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</td><td>${h(i.quantity)} ‡∏ä‡∏∏‡∏î</td></tr>`,u=`
                                <tr><td>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</td><td>${C(i.description)||"-"}</td></tr>
                                <tr><td>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏ä‡∏∏‡∏î</td><td>${E(h(i.price_per_item))}</td></tr>
                                <tr><td>‡∏£‡∏ß‡∏°</td><td><strong>${E(F.calculateRemovalPrice(i).total)}</strong></td></tr>
                            `,a=!0;break;default:W[i.type]?.templateId==="#areaBasedTpl"&&(b=`<tr><td>‡∏Ç‡∏ô‡∏≤‡∏î</td><td>${h(i.width_m).toFixed(2)} x ${h(i.height_m).toFixed(2)} ‡∏°.</td></tr>`,u=`<tr><td>‡∏£‡∏´‡∏±‡∏™</td><td>#${C(i.code)||"-"}</td></tr>`,i.opening_style&&(u+=`<tr><td>‡πÄ‡∏õ‡∏¥‡∏î</td><td>${C(i.opening_style)}</td></tr>`),i.adjustment_side&&(u+=`<tr><td>‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å</td><td>${C(i.adjustment_side)}</td></tr>`));break}return u&&(a=!0),`
                 <div class="lookbook-details" data-item-type="${C(i.type)}">
                    ${ro(i,t.id,f)}
                    <div class="spec-table-wrapper">
                        ${m}
                        <table class="spec-table">
                            ${u}
                            ${b}
                            ${i.notes?`<tr><td>‡πÇ‡∏ô‡πâ‡∏ï</td><td>${C(i.notes)}</td></tr>`:""}
                        </table>
                    </div>
                </div>
            `}).join('<hr class="lookbook-hr">');return d.trim()?`
            <div class="lookbook-room">
                <h4><i class="ph ph-map-pin"></i> ${C(t.room_name)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á"}</h4>
                ${d}
            </div>
        `:""}).join("");return a?`
        <div class="lookbook-summary">
            <div class="lookbook-customer-info">
                <strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${C(e.customer_name)||"-"}<br/>
                <strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${C(e.customer_address||"-").replace(/\n/g,"<br/>")}
            </div>
            <div class="lookbook-totals">
                <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î): ${E(n)} ‡∏ö‡∏≤‡∏ó</span>
                ${s>0?`<span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: -${E(s)} ‡∏ö‡∏≤‡∏ó</span>`:""}
                <span class="grand-total">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${E(o)} ‡∏ö‡∏≤‡∏ó</span>
            </div>
        </div>
    `+r:'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</p>'}function Lt(e={}){const n=document.querySelector(_.roomTpl);if(!n)return console.error("Room template not found"),null;const o=n.content.cloneNode(!0).firstElementChild;o.id=e.id||`room-${Date.now()}`,o.open=e.is_open!==!1,o.dataset.roomDefaults=JSON.stringify(e.room_defaults||{});const a=o.querySelector(_.roomNameInput),r=o.querySelector("[data-room-name-display]"),c=o.querySelector("[data-room-brief]"),t=o.querySelector(_.allItemsContainer),l=()=>{const f=a.value||"‡∏´‡πâ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)";r&&(r.textContent=f)};a&&a.addEventListener("input",l);const d=o.querySelector("summary");d&&d.addEventListener("click",()=>{});const i=e.room_name||`‡∏´‡πâ‡∏≠‡∏á ${document.querySelectorAll(_.room).length+1}`;if(a){a.value=i;const f=`room_name_${o.id}`;a.id=f;const u=a.closest(".form-group")?.querySelector("label");u&&u.setAttribute("for",f)}return r&&(r.textContent=i),e.is_suspended&&o.classList.add("is-suspended"),o.getItemsContainer=()=>t,o.updateBrief=f=>{c&&(c.innerHTML=f)},o}function ke(e={}){const n=document.querySelector(_.setTpl);if(!n)return console.error("Set template not found"),null;const o=n.content.cloneNode(!0).firstElementChild;o.dataset.type="set";const a=o.querySelector('input[name="width_m"]'),r=o.querySelector('input[name="height_m"]'),c=o.querySelector('select[name="set_style"]'),t=o.querySelector('select[name="fabric_variant"]'),l=o.querySelector('select[name="set_price_per_m"]'),d=o.querySelector('select[name="sheer_price_per_m"]'),i=o.querySelector('select[name="louis_price_per_m"]'),f=o.querySelector('input[name="fabric_code"]'),u=o.querySelector('input[name="sheer_fabric_code"]'),m=o.querySelector('select[name="opening_style"]'),b=o.querySelector('select[name="adjustment_side"]'),p=o.querySelector('input[name="notes"]'),y=o.querySelector('[data-set-control="opening_style_wrap"]'),v=o.querySelector('[data-set-control="adjustment_side_wrap"]'),k=o.querySelector('[data-set-control="louis_price_wrap"]'),L=o.querySelector('[data-set-control="fabric_price_wrap"]'),B=o.querySelector('[data-set-control="fabric_code_wrap"]'),R=o.querySelector("[data-sheer-wrap]"),x=o.querySelector("[data-sheer-code-wrap]"),P=o.querySelector("[data-set-summary]"),j=o.querySelector(".item-details-more"),H=o.querySelector('[data-act="toggle-more-details"]'),S=H?.parentElement,w=o.querySelector('[name="enable_set_price"]'),D=o.querySelector('[name="set_price_override"]'),I=o.querySelector(".calculable-fields"),g=()=>({width_m:a.value,height_m:r.value,style:c.value,fabric_variant:t.value,price_per_m_raw:l.value,sheer_price_per_m:d.value,louis_price_per_m:i.value,is_suspended:o.classList.contains("is-suspended"),enable_set_price:w.checked,set_price_override:D.value}),M=()=>{const A=g();if(A.enable_set_price){const V=h(A.set_price_override);o.dataset.totalPrice=V,P&&(P.innerHTML=`‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏´‡∏°‡∏≤: <b>${E(V)}</b> ‡∏ö.`),H&&(H.dataset.priceSummary="");return}const O=F.calculateSetPrice(A);o.dataset.totalPrice=O.total;let U=`‡∏£‡∏≤‡∏Ñ‡∏≤: <b>${E(O.total)}</b> ‡∏ö.`;if(A.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"){const V=[];O.opaque>0&&V.push(`‡∏ó‡∏∂‡∏ö: ${E(O.opaque)}`),O.sheer>0&&V.push(`‡πÇ‡∏õ‡∏£‡πà‡∏á: ${E(O.sheer)}`),O.louis>0&&V.push(`‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå: ${E(O.louis)}`),V.length>0&&(U+=` <small>(${V.join(", ")})</small>`)}else O.opaque>0&&O.sheer>0&&(U+=` <small>(‡∏ó‡∏∂‡∏ö: ${E(O.opaque)}, ‡πÇ‡∏õ‡∏£‡πà‡∏á: ${E(O.sheer)})</small>`);const Z=F.fabricYardage(A.style,A.width_m);Z>0&&(U+=` <small>&bull; ${Z.toFixed(2)} ‡∏´‡∏•‡∏≤</small>`);const Y=h(A.height_m);let ce="";if(Y>2.8?ce='<div class="height-warning" style="margin-top: 0.5rem; width: fit-content;">(‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡πâ‡∏≤ ‡∏ï‡∏±‡∏î‡∏ï‡∏≤‡∏°‡∏¢‡∏≤‡∏ß)</div>':Y>2.5&&(ce='<div class="height-warning" style="margin-top: 0.5rem; width: fit-content;">(‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ú‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ 3.20)</div>'),U+=ce,P?P.innerHTML=U:console.warn("Summary element not found for set item."),H){let V=[];const fe=A.style,Ae=A.fabric_variant,Pe=h(A.price_per_m_raw),ct=h(A.sheer_price_per_m),it=h(A.louis_price_per_m);fe==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?it>0&&V.push(`‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå: ${E(it)}`):(Ae.includes("‡∏ó‡∏∂‡∏ö")&&Pe>0&&V.push(`‡∏ó‡∏∂‡∏ö: ${E(Pe)}`),Ae.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&ct>0&&V.push(`‡πÇ‡∏õ‡∏£‡πà‡∏á: ${E(ct)}`));const Je=V.join(" | ");H.dataset.priceSummary=Je;const Ye=H.querySelector("span");j&&Ye&&!j.classList.contains("show")&&(Je?Ye.innerHTML=`‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° <small>(${Je})</small>`:Ye.textContent="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°")}},T=$e(()=>{M(),o.dispatchEvent(new CustomEvent("item-update",{bubbles:!0}))},200),$=()=>{const A=c.value,O=t.value,U=A==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",Z=O.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á"),Y=O==="‡πÇ‡∏õ‡∏£‡πà‡∏á"&&!U,ce=O==="‡∏ó‡∏∂‡∏ö"&&!U;R?.classList.toggle("hidden",!Z||U),x?.classList.toggle("hidden",!Z||U);const V=Y||U;l&&(l.disabled=V,V&&(l.value="")),f&&(f.disabled=V,V&&(f.value=""));const fe=ce||U;d&&(d.disabled=fe,fe&&(d.value="")),u&&(u.disabled=fe,V&&(u.value=""))},N=()=>{const A=c.value,O=A==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö",U=A==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",Z=O||U||A==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö";y&&y.classList.toggle("hidden",Z),v&&v.classList.toggle("hidden",!O),k&&k.classList.toggle("hidden",!U),L&&L.classList.toggle("hidden",U),B&&B.classList.toggle("hidden",U),$()},G=()=>{const A=w.checked;D.disabled=!A,o.classList.toggle("is-override-active",A),I&&I.classList.toggle("is-override-active",A),A||(D.value=""),T()};o.addEventListener("input",A=>{A.target===t&&$(),A.target===c&&N(),T()});const te=A=>{ot(A),T()};if(a.addEventListener("blur",te),r.addEventListener("blur",te),w.addEventListener("change",G),D.addEventListener("focus",_e),D.addEventListener("blur",ve),j&&S){const A=o.querySelector(".item-grid");A&&A.appendChild(S)}return a.value=ee(e.width_m),r.value=ee(e.height_m),c.value=e.style||"‡∏•‡∏≠‡∏ô",t.value=e.fabric_variant||"‡∏ó‡∏∂‡∏ö",l.value=e.price_per_m_raw||"",d.value=e.sheer_price_per_m||"",i.value=e.louis_price_per_m||"",f.value=e.fabric_code||"",u.value=e.sheer_fabric_code||"",m.value=e.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á",b.value=e.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤",p.value=e.notes||"",o.querySelector('input[name="track_color"]').value=e.track_color||"‡∏Ç‡∏≤‡∏ß",o.querySelector('input[name="bracket_color"]').value=e.bracket_color||"‡∏Ç‡∏≤‡∏ß",o.querySelector('input[name="finial_color"]').value=e.finial_color||"‡∏Ç‡∏≤‡∏ß",o.querySelector('input[name="grommet_color"]').value=e.grommet_color||"‡πÄ‡∏á‡∏¥‡∏ô",o.querySelector('input[name="louis_valance"]').value=e.louis_valance||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",o.querySelector('input[name="louis_tassels"]').value=e.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤",e.is_suspended&&o.classList.add("is-suspended"),e.enable_set_price&&(w.checked=!0),e.set_price_override>0&&(D.value=e.set_price_override===0?"0":E(e.set_price_override)),N(),G(),M(),o}function yt(e={}){const n=document.querySelector(_.wallTpl);if(!n)return null;const o=n.content.cloneNode(!0).firstElementChild,a=o.querySelector('input[name="wall_width_m"]');a.value=ee(e.width);const r=`wall_width_${Date.now()}_${Math.random().toString(36).substring(2,7)}`;a.id=r;const c=o.querySelector("label");return c&&c.setAttribute("for",r),o}function xe(e={}){const n=document.querySelector(_.wallpaperTpl);if(!n)return console.error("Wallpaper template not found"),null;const o=n.content.cloneNode(!0).firstElementChild;o.dataset.type="wallpaper";const a=o.querySelector('[name="wallpaper_height_m"]'),r=o.querySelector('[name="wallpaper_price_roll"]'),c=o.querySelector('[name="wallpaper_install_cost"]'),t=o.querySelector('[name="wallpaper_code"]'),l=o.querySelector('[name="wallpaper_notes"]'),d=o.querySelector("[data-walls-container]"),i=o.querySelector("[data-wallpaper-summary]"),f=o.querySelector(".item-details-more"),u=o.querySelector('[data-act="toggle-more-details"]'),m=u?.parentElement,b=o.querySelector('[name="enable_set_price"]'),p=o.querySelector('[name="set_price_override"]'),y=o.querySelector(".calculable-fields"),v=()=>({height_m:a.value,price_per_roll:r.value,install_cost_per_roll:c.value,widths:Array.from(d.querySelectorAll('input[name="wall_width_m"]')).map(x=>x.value),is_suspended:o.classList.contains("is-suspended")}),k=()=>{const x=v();if(x.enable_set_price){const H=h(x.set_price_override);o.dataset.totalPrice=H,i&&(i.innerHTML=`‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏´‡∏°‡∏≤: <b>${E(H)}</b> ‡∏ö.`),u&&(u.dataset.priceSummary="");return}const P=F.calculateWallpaperPrice(x);o.dataset.totalPrice=P.total;let j=`‡∏£‡∏ß‡∏°: <b>${E(P.total)}</b> ‡∏ö. `;if((P.material>0||P.install>0)&&(j+=`<small>(‡∏ß‡∏≠‡∏•‡∏•‡πå: ${E(P.material)}, ‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏≤‡∏á: ${E(P.install)})</small>`),P.rolls>0&&(j+=` &bull; ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${ie(P.sqm,2)} ‡∏ï‡∏£.‡∏°. &bull; ‡πÉ‡∏ä‡πâ: ${P.rolls} ‡∏°‡πâ‡∏ß‡∏ô`),i&&(i.innerHTML=j),u){let H=[];const S=h(x.price_per_roll),w=x.install_cost_per_roll;if(S>0&&H.push(`‡∏°‡πâ‡∏ß‡∏ô: ${E(S)}`),w==="0")H.push("‡∏ä‡πà‡∏≤‡∏á: 0");else{const g=h(w);g>0&&H.push(`‡∏ä‡πà‡∏≤‡∏á: ${E(g)}`)}const D=H.join(" | ");u.dataset.priceSummary=D;const I=u.querySelector("span");f&&I&&!f.classList.contains("show")&&(D?I.innerHTML=`‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° <small>(${D})</small>`:I.textContent="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°")}},L=$e(()=>{k(),o.dispatchEvent(new CustomEvent("item-update",{bubbles:!0}))},200),B=()=>{const x=b.checked;p.disabled=!x,o.classList.toggle("is-override-active",x),y&&y.classList.toggle("is-override-active",x),x||(p.value=""),L()};o.addEventListener("input",L);const R=x=>{ot(x),L()};if(a.addEventListener("blur",R),o.addEventListener("blur",x=>{x.target.name==="wall_width_m"&&R(x)},!0),b.addEventListener("change",B),p.addEventListener("focus",_e),p.addEventListener("blur",ve),f&&m){const x=o.querySelector(".item-grid");x&&x.appendChild(m)}if(e.widths&&e.widths.length>0)e.widths.forEach(x=>{const P=yt({width:x});P&&d.appendChild(P)});else{const x=yt();x&&d.appendChild(x)}return a.value=ee(e.height_m),r.value=e.price_per_roll>0?E(e.price_per_roll):"",Object.prototype.hasOwnProperty.call(e,"install_cost_per_roll")&&(c.value=e.install_cost_per_roll===0?"0":e.install_cost_per_roll>0?E(e.install_cost_per_roll):""),t.value=e.wallpaper_code||"",l.value=e.notes||"",e.is_suspended&&o.classList.add("is-suspended"),e.enable_set_price&&(b.checked=!0),e.set_price_override>0&&(p.value=e.set_price_override===0?"0":E(e.set_price_override)),B(),k(),o}function Le(e,n={}){const s=document.querySelector(_.areaBasedTpl);if(!s)return console.error("AreaBased template not found"),null;const a=s.content.cloneNode(!0).firstElementChild;a.dataset.type=e;const r=W[e]||{name:"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á"};a.classList.add(`${e.replace(/_/g,"-")}-item`);const c=a.querySelector(".item-type-display"),t=a.querySelector('[name="area_width_m"]'),l=a.querySelector('[name="area_height_m"]'),d=a.querySelector('[name="area_price_sqyd"]'),i=a.querySelector('[name="area_code"]'),f=a.querySelector('[name="area_notes"]'),u=a.querySelector(".btn-favorite"),m=a.querySelector(".btn-show-favs"),b=a.querySelector("[data-area-summary]"),p=a.querySelector(".item-details-more"),y=a.querySelector('[data-act="toggle-more-details"]'),v=y?.parentElement,k=a.querySelector('[name="enable_set_price"]'),L=a.querySelector('[name="set_price_override"]'),B=a.querySelector(".calculable-fields"),R=p?.querySelector(".item-grid"),x=R?.querySelector('[name="area_price_sqyd"]')?.closest(".form-group");let P,j;if(R&&x){if(e==="partition"||e==="pleated_screen"){const g=document.createElement("div");g.className="form-group",g.innerHTML=`
                <label>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î
                    <select name="opening_style">
                        <option value="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á">‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á</option>
                        <option value="‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß">‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</option>
                    </select>
                </label>
            `,R.insertBefore(g,x),P=g.querySelector("select")}else if(["wooden_blind","roller_blind","vertical_blind","aluminum_blind"].includes(e)){const g=document.createElement("div");g.className="form-group",g.innerHTML=`
                <label>‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏±‡∏ö
                    <select name="adjustment_side">
                        <option value="‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤">‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤</option>
                        <option value="‡∏õ‡∏£‡∏±‡∏ö‡∏ã‡πâ‡∏≤‡∏¢">‡∏õ‡∏£‡∏±‡∏ö‡∏ã‡πâ‡∏≤‡∏¢</option>
                    </select>
                </label>
            `,R.insertBefore(g,x),j=g.querySelector("select")}(P||j)&&x&&x.classList.remove("full-width-item")}const H=()=>({width_m:t.value,height_m:l.value,price_sqyd:d.value,is_suspended:a.classList.contains("is-suspended"),enable_set_price:k.checked,set_price_override:L.value}),S=()=>{const g=H();if(g.enable_set_price){const $=h(g.set_price_override);a.dataset.totalPrice=$,b&&(b.innerHTML=`‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏´‡∏°‡∏≤: <b>${E($)}</b> ‡∏ö.`),y&&(y.dataset.priceSummary="");return}const M=F.calculateAreaBasedPrice(g);a.dataset.totalPrice=M.total;const T=M.sqyd>0?` &bull; ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${ie(M.sqyd,2)} ‡∏ï‡∏£.‡∏´‡∏•‡∏≤`:"";if(b&&(b.innerHTML=`‡∏£‡∏≤‡∏Ñ‡∏≤: <b>${E(M.total)}</b> ‡∏ö.${T}`),y){let $="";const N=h(g.price_sqyd);N>0&&($=`‡∏ï‡∏£.‡∏´‡∏•‡∏≤: ${E(N)}`),y.dataset.priceSummary=$;const G=y.querySelector("span");p&&G&&!p.classList.contains("show")&&($?G.innerHTML=`‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° <small>(${$})</small>`:G.textContent="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°")}},w=$e(()=>{S(),a.dispatchEvent(new CustomEvent("item-update",{bubbles:!0}))},200),D=()=>{const g=k.checked;L.disabled=!g,a.classList.toggle("is-override-active",g),B&&B.classList.toggle("is-override-active",g),g||(L.value=""),w()};a.addEventListener("input",w);const I=g=>{ot(g),w()};if(t.addEventListener("blur",I),l.addEventListener("blur",I),k.addEventListener("change",D),L.addEventListener("focus",_e),L.addEventListener("blur",ve),p&&v){const g=a.querySelector(".item-grid");g&&g.appendChild(v)}return c&&(c.textContent=r.name),i&&(i.dataset.favoriteType=e),u&&(u.dataset.type=e),m&&(m.dataset.type=e),t.value=ee(n.width_m),l.value=ee(n.height_m),d.value=n.price_sqyd>0?E(n.price_sqyd):"",i.value=n.code||"",f.value=n.notes||"",P&&(P.value=n.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"),j&&(j.value=n.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤"),n.is_suspended&&a.classList.add("is-suspended"),n.enable_set_price&&(k.checked=!0),n.set_price_override>0&&(L.value=n.set_price_override===0?"0":E(n.set_price_override)),D(),S(),a}function Ce(e={}){const n=document.querySelector("#removalTpl");if(!n)return console.error("Removal template not found"),null;const o=n.content.cloneNode(!0).firstElementChild;o.dataset.type="removal";const a=W.removal||{name:"‡∏£‡∏∑‡πâ‡∏≠‡∏ñ‡∏≠‡∏ô"};o.classList.add("removal-item");const r=o.querySelector(".item-type-display"),c=o.querySelector('input[name="quantity"]'),t=o.querySelector('input[name="price_per_item"]'),l=o.querySelector('input[name="description"]'),d=o.querySelector('input[name="notes"]'),i=o.querySelector("[data-removal-summary]"),f=o.querySelector(".item-details-more"),u=o.querySelector('[data-act="toggle-more-details"]'),m=u?.parentElement,b=()=>({quantity:c.value,price_per_item:t.value,is_suspended:o.classList.contains("is-suspended")}),p=()=>{const v=b(),k=F.calculateRemovalPrice(v);o.dataset.totalPrice=k.total;let L=`‡∏£‡∏ß‡∏°: <b>${E(k.total)}</b> ‡∏ö.`;const B=h(v.quantity);if(B>0&&(L+=` <small>(${B} ‡∏ä‡∏∏‡∏î)</small>`),i&&(i.innerHTML=L),u){let R="";const x=h(v.price_per_item);x>0&&(R=`‡∏ä‡∏∏‡∏î‡∏•‡∏∞: ${E(x)}`),u.dataset.priceSummary=R;const P=u.querySelector("span");f&&P&&!f.classList.contains("show")&&(R?P.innerHTML=`‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° <small>(${R})</small>`:P.textContent="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°")}},y=$e(()=>{p(),o.dispatchEvent(new CustomEvent("item-update",{bubbles:!0}))},200);if(o.addEventListener("input",y),c.addEventListener("focus",_e),c.addEventListener("blur",ve),t.addEventListener("focus",_e),t.addEventListener("blur",ve),f&&m){const v=o.querySelector(".item-grid");v&&v.appendChild(m)}return r&&(r.textContent=a.name),c.value=h(e.quantity)>0?e.quantity:"",t.value=e.price_per_item>0?E(e.price_per_item):"",l.value=e.description||"",d.value=e.notes||"",e.is_suspended&&o.classList.add("is-suspended"),p(),o}let De=!1;async function po(){const e=document.querySelector(_.exportOptionsModal);if(!e)return null;const n=e.querySelector("#pageBreakBuffer"),s=e.querySelector("#pageBreakBufferValue");n&&s&&(s.textContent=n.value,n.oninput=()=>{s.textContent=n.value});const o=document.querySelector("#vat_enabled"),a=o&&o.value==="1"?"include":"exclude",r=e.querySelector(`input[name="vat_option"][value="${a}"]`);r&&(r.checked=!0);const c=await J(_.exportOptionsModal);return n&&(n.oninput=null),!c||c.cancelled?null:{vatOption:e.querySelector('input[name="vat_option"]:checked')?.value||"include",showDetails:(e.querySelector('input[name="item_details_option"]:checked')?.value||"show_details")==="show_details",exportMethod:e.querySelector("#exportMethod")?.value||"direct",pageBreakBuffer:parseInt(n?.value,10)||3}}function fo(e,n){const s=e.querySelector("#discountToggle"),o=e.querySelector("#vatToggle"),a=e.querySelector("#discountInputsGroup"),r=e.querySelector("#discountVatResultRow"),c=e.querySelector("#discountPercent"),t=e.querySelector("#discountAmount"),l=e.querySelector("#discountFinalTotal"),d=e.querySelector("#discountFinalTotalWithVat"),i=e.querySelector("#discountVatAmountRow"),f=e.querySelector("#discountVatAmount"),u=k=>{if(De)return;De=!0;const L=s.checked,B=o.checked;a.classList.toggle("is-disabled",!L),c.disabled=!L,t.disabled=!L;let R=0;if(L){if(k==="percent"){const P=h(c.value);R=n*(Math.max(0,P)/100),t.value=R>0?E(Math.round(R)):""}else R=h(t.value);if(R=Math.max(0,Math.min(R,n)),k!=="percent"){const P=n>0?R/n*100:0;c.value=P>0&&isFinite(P)?ie(P,2):""}}const x=n-R;if(l&&(l.textContent=E(x)),r.classList.toggle("hidden",!B),i&&i.classList.toggle("hidden",!B),B){const P=x*Be().baseVatRate;f&&(f.textContent=E(P));const j=x+P;d&&(d.textContent=E(j))}setTimeout(()=>{De=!1},50)},m=()=>u("percent"),b=()=>u("amount"),p=()=>u("toggle"),y=k=>{h(k.target.value)>0&&(k.target.value=h(k.target.value))},v=k=>{const L=h(k.target.value);k.target.value=L>0?E(L):"",u("amount")};return s.addEventListener("change",p),o.addEventListener("change",p),c.addEventListener("input",m),t.addEventListener("input",b),t.addEventListener("focus",y),t.addEventListener("blur",v),{runInitialUpdate:k=>u(k),cleanup:()=>{c.removeEventListener("input",m),t.removeEventListener("input",b),t.removeEventListener("focus",y),t.removeEventListener("blur",v),s.removeEventListener("change",p),o.removeEventListener("change",p),De=!1}}}async function mo(){const e=document.querySelector("#discountModal");if(!e)return Promise.resolve({cancelled:!0});const n=e.querySelector("#discountSubtotal"),s=e.querySelector("#discountPercent"),o=e.querySelector("#discountAmount"),a=e.querySelector("#discountToggle"),r=e.querySelector("#vatToggle"),c=document.querySelector("#discount_type"),t=document.querySelector("#discount_value"),l=document.querySelector("#vat_enabled"),d=h(document.querySelector("#originalTotal").dataset.rawTotal||document.querySelector("#grandTotal").textContent);n&&(n.textContent=E(d));const{runInitialUpdate:i,cleanup:f}=fo(e,d),u=c.value,m=h(t.value),b=l.value==="1";a.checked=m>0,r.checked=b;let p="amount";a.checked?u==="percent"?(s.value=m,p="percent"):(o.value=m,o.value=E(m)):h(s.value)>0?p="percent":h(o.value)>0&&(p="amount"),i(p);const y=await J("#discountModal");if(f(),y&&!y.cancelled){const v=a.checked,k=h(s.value),L=h(o.value),B=document.activeElement;v?k>0&&(B===s||B!==o)?(c.value="percent",t.value=k):L>0?(c.value="amount",t.value=L):(c.value="amount",t.value=0):(c.value="amount",t.value=0),l.value=r.checked?"1":"0",X()}}async function ho(){const e=Me();if(!e)return;const n=document.querySelector("#hardwareModal");if(!n)return;const s=e.querySelector('[name="set_style"]'),o=s?s.value:null,a=o==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà",r=o==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö",c=o==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",t=n.querySelector("#trackColorGroup"),l=n.querySelector("#bracketColorGroup"),d=n.querySelector("#finialColorGroup"),i=n.querySelector("#grommetColorGroup"),f=n.querySelector("#louisValanceGroup"),u=n.querySelector("#louisTasselGroup"),m=n.querySelector("#hardwareApplyToRoom");n.querySelector('[name="modal_track_color"]').value=e.querySelector('[name="track_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",n.querySelector('[name="modal_bracket_color"]').value=e.querySelector('[name="bracket_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",n.querySelector('[name="modal_finial_color"]').value=e.querySelector('[name="finial_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",n.querySelector('[name="modal_grommet_color"]').value=e.querySelector('[name="grommet_color"]')?.value||"‡πÄ‡∏á‡∏¥‡∏ô",n.querySelector('[name="modal_louis_valance"]').value=e.querySelector('[name="louis_valance"]')?.value||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",n.querySelector('[name="modal_louis_tassels"]').value=e.querySelector('[name="louis_tassels"]')?.value||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤",t&&(t.style.display=""),l&&(l.style.display=""),d&&d.classList.toggle("hidden",!a),i&&i.classList.toggle("hidden",!a),f&&f.classList.toggle("hidden",!c),u&&u.classList.toggle("hidden",!c),m&&(m.disabled=r||c);const b=await J("#hardwareModal");b&&!b.cancelled&&(e.querySelector('[name="track_color"]').value=n.querySelector('[name="modal_track_color"]').value,e.querySelector('[name="bracket_color"]').value=n.querySelector('[name="modal_bracket_color"]').value,a?(e.querySelector('[name="finial_color"]').value=n.querySelector('[name="modal_finial_color"]').value,e.querySelector('[name="grommet_color"]').value=n.querySelector('[name="modal_grommet_color"]').value):c&&(e.querySelector('[name="louis_valance"]').value=n.querySelector('[name="modal_louis_valance"]').value,e.querySelector('[name="louis_tassels"]').value=n.querySelector('[name="modal_louis_tassels"]').value),ne(),q("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏•‡πâ‡∏ß","success"))}async function _t(){const e=document.querySelector("#roomControlCenterModal"),n=Pt();if(!n||!e){console.error("Batch confirm: Cannot find current room or modal context.");return}const s=e.querySelector("#batch-select-device-type-value"),o=e.querySelector("#batch-device-list-container"),a=e.querySelector("#batch-target-device-type-value"),r=s.value,c=a.value,t=Array.from(o.querySelectorAll('input[name="batch_device_select"]:checked')).map(m=>m.value);let l={};if(t.length===0){q("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç","warning");return}if(r===c&&c!=="set"){q("‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô)","warning");return}if(c==="set"&&(l.new_style=e.querySelector("#batch-curtain-type").value,!l.new_style)){q("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà","warning");return}const d=W[c]?.name||c;let i=`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ${t.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó "${d}"`;if(l.new_style&&(i+=` (‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: ${l.new_style})`),i+="? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï",!await de("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ö‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°",i))return;ue(K()),oe();let f=0,u=null;t.forEach(m=>{const b=n.querySelector(`.item-card[data-batch-id="${m}"]`);if(!b){console.warn(`Item with batch-id "${m}" not found.`);return}const p=Ht(b);if(!p){console.warn(`Could not extract data from item with batch-id "${m}". Skipping.`);return}const y=b.classList.contains("is-suspended");let v={width_m:p.width_m,height_m:p.height_m,notes:p.notes};p.type==="set"&&c==="set"?(v={...p},v.style=l.new_style,l.new_style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"||l.new_style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"?(v.opening_style="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á",l.new_style==="‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏õ‡πä‡∏ö"&&(v.adjustment_side="‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤")):l.new_style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"&&(v.opening_style="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á",v.adjustment_side="‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤",v.louis_valance=p.louis_valance||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",v.louis_tassels=p.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤"),p.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"&&l.new_style!=="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"&&(delete v.louis_valance,delete v.louis_tassels,delete v.louis_price_per_m),p.style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"&&l.new_style!=="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"&&(v.adjustment_side="‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤")):c==="set"?v.style=l.new_style:c==="wallpaper"?p.type==="wallpaper"?(v.height_m=p.height_m,v.widths=p.widths):(v.widths=[v.width_m],delete v.width_m):W[c]?.templateId==="#areaBasedTpl"&&p.type==="wallpaper"&&delete v.width_m;let k;try{if(c==="set")k=ke(v);else if(c==="wallpaper")k=xe(v);else if(W[c]?.templateId==="#areaBasedTpl")k=Le(c,v);else{console.error(`Unsupported target type "${c}" during batch update.`);return}}catch(L){console.error(`Error creating new item element for batch-id "${m}":`,L);return}k&&(b.replaceWith(k),y&&k.classList.add("is-suspended"),k.classList.add("item-created"),f++,u||(u=k))}),f>0?(le(),X(),q(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ${f} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`,"success"),u&&setTimeout(()=>he(u),150)):q("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏î‡∏ñ‡∏π‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç","warning"),e&&typeof e.closeModal=="function"&&e.closeModal({confirmed:!0,changed:f>0})}function yo(e,n,s){const o=r=>{const c=r.target,t=c.closest(".defaults-content");if(!t)return;const l=c.checked,d=t.querySelector(".defaults-inputs-grid");t.classList.toggle("is-enabled-content",l),d&&(d.classList.toggle("hidden",!l),d.querySelectorAll('input[type="text"], input[type="number"], select, .btn-show-favs').forEach(i=>{i.disabled=!l,i.matches(".btn-show-favs")&&(i.style.opacity=l?"1":"0.5",i.style.pointerEvents=l?"auto":"none")}))};e.querySelectorAll(".defaults-content").forEach(r=>{const c=r.querySelector('.defaults-enable-toggle input[type="checkbox"]');if(!c)return;const t=c.name,l=n[t]===!0||n[t]==="1";c.checked=l,o({target:c}),c.addEventListener("change",o),s({element:c,event:"change",handler:o});const d=r.querySelector(".defaults-inputs-grid");d&&d.querySelectorAll('input[type="text"], input[type="number"]').forEach(i=>{const f=i.name,u=n[f];i.type==="text"&&i.inputMode==="numeric"?(i.value=u===0?"0":u!=null&&u>0?E(u):"",i.addEventListener("focus",_e),i.addEventListener("blur",ve),s({element:i,event:"focus",handler:_e}),s({element:i,event:"blur",handler:ve})):i.value=u||""})})}function _o(e,n,s){const o=e.querySelector("#batch-select-device-type-value"),a=e.querySelector("#batch-device-list-container"),r=e.querySelector("#batch-target-device-type-value"),c=e.querySelector("#batch-curtain-type-options"),t=e.querySelector("#batchEditorConfirmBtn"),l=e.querySelector(".batch-select-all-container"),d=()=>{o&&(o.value="");const p=document.getElementById("batch-select-device-type-display");p&&(p.textContent=p.dataset.placeholderText||"‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"),document.getElementById("batch-select-device-type")?.classList.add("is-placeholder"),a.innerHTML='<p class="placeholder-text">[‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£]</p>',r&&(r.value="");const y=document.getElementById("batch-target-device-type-display");y&&(y.textContent=y.dataset.placeholderText||"‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÉ‡∏´‡∏°‡πà"),document.getElementById("batch-target-device-type")?.classList.add("is-placeholder"),c.classList.add("hidden"),l&&l.classList.add("hidden"),t.disabled=!0},i=()=>{const p=r.value!=="",y=a.querySelector('input[name="batch_device_select"]:checked')!==null;t.disabled=!(p&&y)},f=p=>{const y=p.detail.type;bt(y,a,n),i()};document.addEventListener("batch-type-filter-change",f),s({element:document,event:"batch-type-filter-change",handler:f});const u=p=>{const y=e.querySelector("#batch-select-all-checkbox");if(p.target.id==="batch-select-all-checkbox"){const v=p.target.checked;a.querySelectorAll('input[name="batch_device_select"]').forEach(k=>{k.checked=v})}else if(p.target.name==="batch_device_select"){const v=a.querySelectorAll('input[name="batch_device_select"]'),k=Array.from(v).every(B=>B.checked),L=Array.from(v).some(B=>B.checked);y&&(y.checked=k,y.indeterminate=!k&&L)}i()};l.addEventListener("change",u),s({element:l,event:"change",handler:u}),a.addEventListener("change",u),s({element:a,event:"change",handler:u});const m=p=>{const v=p.target.value==="set";c.classList.toggle("hidden",!v),i()};r.addEventListener("change",m),s({element:r,event:"change",handler:m}),rt().find(p=>p.element===t&&p.event==="click")||(t.addEventListener("click",_t),s({element:t,event:"click",handler:_t})),d(),bt("",a,n)}async function vo(e){if(!e)return;Dt(e);const n=document.querySelector("#roomControlCenterModal"),s=document.querySelector(_.roomDefaultsForm);if(!n||!s)return;rt().forEach(({element:i,event:f,handler:u})=>{i.removeEventListener(f,u)}),Rt();const o=JSON.parse(e.dataset.roomDefaults||"{}"),a=n.querySelectorAll(".rcc-tabs .tab-link"),r=n.querySelectorAll(".rcc-tab-content"),c=n.querySelector("#general-settings"),t=n.querySelector("#batchEditorConfirmBtn"),l=n.querySelectorAll("#roomDefaultsApplyBtn, #roomDefaultsConfirmBtn"),d=i=>{const f=i.currentTarget,u=f.dataset.tab;if(!u)return;a.forEach(p=>p.classList.remove("active")),r.forEach(p=>p.classList.remove("active")),f.classList.add("active");const m=n.querySelector(`#${u}`);m&&m.classList.add("active");const b=u==="batch-editor";t.classList.toggle("hidden",!b),l.forEach(p=>p.classList.toggle("hidden",b))};a.forEach(i=>{i.addEventListener("click",d),Qe({element:i,event:"click",handler:d})}),yo(c,o,Qe),_o(n,e,Qe),a.forEach(i=>i.classList.remove("active")),r.forEach(i=>i.classList.remove("active")),n.querySelector('.rcc-tabs .tab-link[data-tab="general-settings"]')?.classList.add("active"),c?.classList.add("active"),t.classList.add("hidden"),l.forEach(i=>i.classList.remove("hidden")),await J("#roomControlCenterModal")}function go(){const e=Pt();if(!e)return;const n=document.querySelector(_.roomDefaultsForm);if(!n)return;const s={};n.querySelectorAll(".defaults-content").forEach(a=>{const r=a.querySelector('.defaults-enable-toggle input[type="checkbox"]');if(r){const c=r.name,t=r.checked;if(s[c]=t,t){const l=a.querySelector(".defaults-inputs-grid");l&&l.querySelectorAll('input[type="text"], input[type="number"]').forEach(d=>{const i=d.name,f=d.value.trim();let u;d.type==="text"&&d.inputMode==="numeric"?u=f===""?void 0:h(f):u=f,(typeof u=="number"&&!isNaN(u)||typeof u=="string"&&u!=="")&&(s[i]=u)})}}}),e.dataset.roomDefaults=JSON.stringify(s),ne();const o=document.querySelector("#roomControlCenterModal");o&&typeof o.closeModal=="function"?(o.closeModal(!0),setTimeout(()=>q("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß","success"),50)):console.error("Could not find room defaults modal or its closer function.")}async function bo(){const e=document.querySelector("#forceApplyModal");if(!e)return;const n=e.querySelector('[name="force_apply_type_hidden"]'),s=e.querySelector("#forceApplySelectedTypeDisplay"),o=e.querySelector('[name="force_apply_code"]'),a=e.querySelector('[name="force_apply_price"]'),r=o?.closest(".form-group-with-favorites")?.querySelector(".btn-show-favs");n&&(n.value=""),s&&(s.textContent="-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --"),o&&(o.value="",o.dataset.favoriteType=""),a&&(a.value=""),r&&(r.disabled=!0),await J("#forceApplyModal")}function So(e,n,s){let o=0;return document.querySelectorAll(".item-card").forEach(r=>{if(r.classList.contains("placeholder-item"))return;const c=r.dataset.type;let t=null,l=null;if(e==="fabric"&&c==="set"?(t=r.querySelector('input[name="fabric_code"]'),l=r.querySelector('select[name="set_price_per_m"]')):e==="sheer"&&c==="set"?(t=r.querySelector('input[name="sheer_fabric_code"]'),l=r.querySelector('select[name="sheer_price_per_m"]')):e==="wallpaper"&&c==="wallpaper"?(t=r.querySelector('input[name="wallpaper_code"]'),l=r.querySelector('input[name="wallpaper_price_roll"]')):c===e&&r.matches(".area-based-item")&&(t=r.querySelector('input[name="area_code"]'),l=r.querySelector('input[name="area_price_sqyd"]')),t&&l){if(t.value=n,t.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),l.tagName==="SELECT")if(Array.from(l.options).some(d=>d.value==s))l.value=s;else{if(console.warn(`Price ${s} not found in options for`,l,". Forcing new option."),!l.querySelector(`option[value="${s}"][data-forced="true"]`)){const i=document.createElement("option");i.value=s,i.textContent=s===0?"0 ‡∏ö‡∏≤‡∏ó":`${E(s)} ‡∏ö‡∏≤‡∏ó (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)`,i.dataset.forced="true",l.appendChild(i)}l.value=s}else l.value=s===0?"0":s!=null&&s>0?E(s):"";l.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),l.dispatchEvent(new Event("blur",{bubbles:!0,cancelable:!0})),o++,t.classList.add("input-highlight"),l.classList.add("input-highlight"),setTimeout(()=>{t.classList.remove("input-highlight"),l.classList.remove("input-highlight")},1200)}}),o}async function wo(){const e=document.querySelector("#forceApplyModal");if(!e)return;const n=e.querySelector('[name="force_apply_type_hidden"]'),s=e.querySelector('[name="force_apply_code"]'),o=e.querySelector('[name="force_apply_price"]'),a=n.value,r=s.value.trim(),c=h(o.value);if(!a){q("‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ","warning"),e.querySelector("#forceApplySelectTypeBtn")?.focus();return}if(!r){q("‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ","warning"),s.focus();return}if(c<0||c<=0&&!["fabric","sheer","wallpaper"].includes(a)){q("‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (> 0)","warning"),o.focus();return}const t=e.querySelector("#forceApplySelectedTypeDisplay");let l=t?t.textContent:a;const d="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ",i=`‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏õ‡πá‡∏ô "${r}" ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏õ‡πá‡∏ô ${E(c)} ‡∏ö‡∏≤‡∏ó ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó "${l}" ***‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£*** ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÜ`;if(!await de(d,i))return;ue(K()),oe();const f=So(a,r,c);f>0?(X(),q(`‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏Å‡∏±‡∏ö ${f} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (${l}) ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`,"success"),e&&typeof e.closeModal=="function"&&e.closeModal({cancelled:!0})):q(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó "${l}" ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï`,"default")}async function Mt(e,n=null){const s=document.querySelector("#itemTypeModal");if(!s)return null;s.querySelector("#itemTypeModalTitle").textContent=e;const o=s.querySelector('label[data-item-type="all"]');o&&(o.style.display="none");let a=n||"set";n&&!W[n]&&(a="set");const r=s.querySelector(`input[name="item_type_option"][value="${a}"]`);if(r)r.checked=!0;else{const l=s.querySelector('input[name="item_type_option"][value="set"]');l&&(l.checked=!0)}const c=await J("#itemTypeModal");if(!c||c.cancelled)return null;const t=s.querySelector('input[name="item_type_option"]:checked');return t?t.value:null}function vt(){const e=document.createElement("div");return e.className="dimension-input-row",e.innerHTML='<div class="form-group"><label class="visually-hidden">‡∏Å‡∏ß‡πâ‡∏≤‡∏á (‡∏°.)</label><input type="number" step="0.01" inputmode="decimal" name="modal_width_m" placeholder="‡∏Å‡∏ß‡πâ‡∏≤‡∏á"></div><div class="form-group"><label class="visually-hidden">‡∏™‡∏π‡∏á (‡∏°.)</label><input type="number" step="0.01" inputmode="decimal" name="modal_height_m" placeholder="‡∏™‡∏π‡∏á"></div><button type="button" class="btn-icon btn-icon-small danger btn-remove-dimension-row" data-act="remove-dimension-row" title="‡∏•‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î" aria-label="‡∏•‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏ñ‡∏ß‡∏ô‡∏µ‡πâ"><i class="ph-bold ph-x"></i></button>',e.querySelectorAll('input[type="number"]').forEach(n=>{n.addEventListener("blur",s=>{const o=h(s.target.value);o>0?s.target.value.includes(".")?s.target.value=ee(o):s.target.value=ee(o/100):s.target.value=""})}),e}async function gt(e,n=!1){const s=document.querySelector("#itemTypeModal");if(!s)return null;const o=s.querySelector("#itemTypeModalTitle"),a=s.querySelector(".radio-card-group");if(!o||!a)return null;o.textContent=n?"‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á":"‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á";let r=a.querySelector('label[data-item-type="all"]');n?(r||(r=document.createElement("label"),r.dataset.itemType="all",r.innerHTML='<input type="radio" name="item_type_option" value="all"><span class="radio-card-content"><strong><i class="ph-fill ph-asterisk"></i> ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</strong><small>All Item Types</small></span>',a.prepend(r)),r.style.display=""):r&&(r.style.display="none");let c=n&&(e===null||e==="all"||e==="")?"all":e&&W[e]?e:"set";const t=a.querySelector(`input[name="item_type_option"][value="${c}"]`);if(t)t.checked=!0;else{const m=a.querySelector(`input[name="item_type_option"][value="${n?"all":"set"}"]`);m&&(m.checked=!0)}const l=await J("#itemTypeModal");if(!l||l.cancelled)return null;const d=s.querySelector('input[name="item_type_option"]:checked');if(!d)return null;const i=d.value,f=d.closest("label")?.querySelector("strong"),u=f?f.textContent.trim():i;return{type:i,displayName:u}}function bt(e,n,s){if((!e||e==="all"||e==="")&&(e=""),!n||!s){n&&(n.innerHTML='<p class="placeholder-text">[‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î]</p>');return}const o=document.querySelector(".batch-select-all-container"),a=document.getElementById("batch-select-all-checkbox"),r=document.getElementById("batch-item-count"),c=e?`.item-card[data-type="${e}"]:not(.placeholder-item)`:".item-card:not(.placeholder-item)",t=s.querySelectorAll(c);if(t.length===0){n.innerHTML='<p class="placeholder-text">[‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á]</p>',o&&o.classList.add("hidden");return}else o&&o.classList.remove("hidden"),r&&(r.textContent=`(${t.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`),a&&(a.checked=!1,a.indeterminate=!1);let l="";t.forEach((d,i)=>{const f=d.querySelector("[data-item-title]"),u=d.querySelector('input[name*="_code"]'),m=d.dataset.type,b=W[m]?.name||m,p=d.querySelector('input[name*="_width_m"]'),y=d.querySelector('input[name*="_height_m"]');let v=`${f?f.textContent:i+1}`,k=`-: ${b}`;u&&u.value?k+=` (${C(u.value)})`:p&&y&&p.value&&y.value&&(k+=` (${p.value}x${y.value} ‡∏°.)`);const L=d.id||`batch-item-${m}-${i}`;d.dataset.batchId=L,l+=`<div class="batch-device-list-item" data-item-type="${m}"><label><input type="checkbox" name="batch_device_select" value="${L}" class="visually-hidden"><div class="item-info"><span class="item-name">${C(v)}</span><span class="item-details">${C(k)}</span></div><div class="visual-checkbox"><i class="ph-fill ph-check-circle"></i><i class="ph ph-circle"></i></div></label></div>`}),n.innerHTML=l}function Se(e={}){const n=document.querySelector(_.roomsContainer);if(!n)return null;Object.keys(e).length===0&&(ue(K()),oe());const s=Lt(e);return s?(n.appendChild(s),Object.keys(e).length===0&&(s.classList.add("item-created"),he(s),s.querySelector('input[name="room_name"]')?.focus()),Ue(),pe(),Ee(),Object.keys(e).length===0&&ne(),s):null}function qo(e,n){if(!n||!e||e.width_m<=0||e.height_m<=0)return;const s=n.getItemsContainer();if(!s)return;const o=document.querySelector("#placeholderItemTpl");if(!o)return console.error("Placeholder template not found"),null;const r=o.content.cloneNode(!0).firstElementChild;r.dataset.widthM=e.width_m,r.dataset.heightM=e.height_m;const c=r.querySelector("[data-placeholder-width]"),t=r.querySelector("[data-placeholder-height]");return c&&(c.textContent=ee(e.width_m)),t&&(t.textContent=ee(e.height_m)),s.appendChild(r),r.classList.add("item-created"),r}function $o(e,n,s){if(!e||!n||!s)return;const o=e.closest(_.room);if(!o)return;ue(K()),oe();const a=JSON.parse(o.dataset.roomDefaults||"{}");let r={width_m:s.width_m,height_m:s.height_m};const c=l=>a[`enable_defaults_${l}`]===!0;switch(n){case"set":c("set")&&(r.fabric_code=a.defaults_fabric_code,r.price_per_m_raw=a.defaults_fabric_price,r.sheer_fabric_code=a.defaults_sheer_code,r.sheer_price_per_m=a.defaults_sheer_price);break;case"wallpaper":c("wallpaper")&&(r.wallpaper_code=a.defaults_wallpaper_code,r.price_per_roll=a.defaults_wallpaper_price_roll,r.install_cost_per_roll=a.defaults_wallpaper_install_cost);break;case"removal":delete r.width_m;break;case"wooden_blind":c("wooden_blind")&&(r.code=a.defaults_wooden_blind_code,r.price_sqyd=a.defaults_wooden_blind_price_sqyd);break;case"roller_blind":c("roller_blind")&&(r.code=a.defaults_roller_blind_code,r.price_sqyd=a.defaults_roller_blind_price_sqyd);break;case"vertical_blind":c("vertical_blind")&&(r.code=a.defaults_vertical_blind_code,r.price_sqyd=a.defaults_vertical_blind_price_sqyd);break;case"partition":c("partition")&&(r.code=a.defaults_partition_code,r.price_sqyd=a.defaults_partition_price_sqyd);break;case"pleated_screen":c("pleated_screen")&&(r.code=a.defaults_pleated_screen_code,r.price_sqyd=a.defaults_pleated_screen_price_sqyd);break;case"aluminum_blind":c("aluminum_blind")&&(r.code=a.defaults_aluminum_blind_code,r.price_sqyd=a.defaults_aluminum_blind_price_sqyd);break}let t;if(n==="set")t=ke(r);else if(n==="wallpaper")t=xe(r);else if(n==="removal")t=Ce(r);else if(W[n]?.templateId==="#areaBasedTpl")t=Le(n,r);else{q(`‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${n}`,"error");return}t&&(e.replaceWith(t),t.classList.add("item-created"),he(t),t.querySelector('input:not([type="hidden"]), select, textarea')?.focus(),le(),X(),q(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${W[n]?.name||"‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"} ‡πÅ‡∏•‡πâ‡∏ß`,"success"))}async function ko(e){if(!e||e.classList.contains("placeholder-item"))return;const n=e.dataset.type,s=await Mt("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",n);if(!s||s===n||!await de("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á","‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?"))return;ue(K()),oe();const o={width_m:h(e.querySelector('input[name$="_width_m"], input[name="width_m"]')?.value),height_m:h(e.querySelector('input[name$="_height_m"], input[name="height_m"]')?.value)};n==="wallpaper"&&(o.height_m=h(e.querySelector(_.wallHeightInput)?.value));const a=e.closest(_.room),r=JSON.parse(a?.dataset.roomDefaults||"{}");let c={width_m:o.width_m>0?o.width_m:void 0,height_m:o.height_m>0?o.height_m:void 0};const t=d=>r[`enable_defaults_${d}`]===!0;switch(s){case"set":t("set")&&(c.fabric_code=r.defaults_fabric_code,c.price_per_m_raw=r.defaults_fabric_price,c.sheer_fabric_code=r.defaults_sheer_code,c.sheer_price_per_m=r.defaults_sheer_price);break;case"wallpaper":t("wallpaper")&&(c.wallpaper_code=r.defaults_wallpaper_code,c.price_per_roll=r.defaults_wallpaper_price_roll,c.install_cost_per_roll=r.defaults_wallpaper_install_cost);break;case"removal":delete c.width_m,c.height_m=o.height_m>0?o.height_m:void 0;break;case"wooden_blind":t("wooden_blind")&&(c.code=r.defaults_wooden_blind_code,c.price_sqyd=r.defaults_wooden_blind_price_sqyd);break;case"roller_blind":t("roller_blind")&&(c.code=r.defaults_roller_blind_code,c.price_sqyd=r.defaults_roller_blind_price_sqyd);break;case"vertical_blind":t("vertical_blind")&&(c.code=r.defaults_vertical_blind_code,c.price_sqyd=r.defaults_vertical_blind_price_sqyd);break;case"partition":t("partition")&&(c.code=r.defaults_partition_code,c.price_sqyd=r.defaults_partition_price_sqyd);break;case"pleated_screen":t("pleated_screen")&&(c.code=r.defaults_pleated_screen_code,c.price_sqyd=r.defaults_pleated_screen_price_sqyd);break;case"aluminum_blind":t("aluminum_blind")&&(c.code=r.defaults_aluminum_blind_code,c.price_sqyd=r.defaults_aluminum_blind_price_sqyd);break}let l;if(s==="set")l=ke(c);else if(s==="wallpaper")l=xe(c);else if(s==="removal")l=Ce(c);else if(W[s]?.templateId==="#areaBasedTpl")l=Le(s,c);else return;l&&(e.replaceWith(l),l.classList.add("item-created"),he(l),l.querySelector('input:not([type="hidden"]), select, textarea')?.focus(),le(),X(),q("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß","success"))}function xo(e){if(!e)return;const n=e.closest(_.room);if(!n||!n.getItemsContainer())return;ue(K()),oe();let o;if(e.classList.contains("placeholder-item")){const a=document.querySelector("#placeholderItemTpl");if(a){o=a.content.cloneNode(!0).firstElementChild,o.dataset.widthM=e.dataset.widthM,o.dataset.heightM=e.dataset.heightM;const c=o.querySelector("[data-placeholder-width]"),t=o.querySelector("[data-placeholder-height]");c&&(c.textContent=ee(e.dataset.widthM)),t&&(t.textContent=ee(e.dataset.heightM)),e.classList.contains("is-suspended")&&o.classList.add("is-suspended")}else{q("‡πÑ‡∏°‡πà‡∏û‡∏ö Template ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Placeholder","error");return}}else{const a=Ht(e);if(!a){q("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ","error");return}if(a.type==="set")o=ke(a);else if(a.type==="wallpaper")o=xe(a);else if(a.type==="removal")o=Ce(a);else if(W[a.type]?.templateId==="#areaBasedTpl")o=Le(a.type,a);else{q("‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","error");return}}if(o){if(e.after(o),o.classList.add("item-created"),!o.classList.contains("placeholder-item")){const a=e.querySelector(_.itemDetailsMore);a&&a.classList.contains("show")&&je(o,!0)}he(o),le(),X(),q("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß","success")}}function Lo(e){const{roomId:n,itemIndex:s}=e.dataset;if(!n||s===void 0)return;const o=document.getElementById("lookbookModal");o&&typeof o.closeModal=="function"&&o.closeModal({cancelled:!0});const a=document.getElementById(n);if(!a){q("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£","error");return}const c=Array.from(a.querySelectorAll(".item-card:not(.item-hidden)"))[parseInt(s,10)];if(!c){q("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£","error");return}a.open=!0,pe(),setTimeout(()=>{st(c),c.classList.add("scrolling-jump"),setTimeout(()=>c.classList.remove("scrolling-jump"),2500)},150)}function Mo(e){const n=Po();if(!n)return;const s=activeFavoriteƒ∞nput.closest("#roomDefaultsModal"),o=n.closest(".item-card"),a=n.closest("#forceApplyModal");let r=n,c=null;const t=r.dataset.favoriteType,l=e.dataset.code,d=h(e.dataset.price);if(o){let u;t==="fabric"?u="set_price_per_m":t==="sheer"?u="sheer_price_per_m":t==="wallpaper"?u="wallpaper_price_roll":u="area_price_sqyd",c=o.querySelector(`[name="${u}"]`)}else if(s){const u=r.closest(".defaults-inputs-grid");if(u){let m;t==="fabric"?m="defaults_fabric_price":t==="sheer"?m="defaults_sheer_price":t==="wallpaper"?m="defaults_wallpaper_price_roll":t==="wooden_blind"?m="defaults_wooden_blind_price_sqyd":t==="roller_blind"?m="defaults_roller_blind_price_sqyd":t==="vertical_blind"?m="defaults_vertical_blind_price_sqyd":t==="partition"?m="defaults_partition_price_sqyd":t==="pleated_screen"?m="defaults_pleated_screen_price_sqyd":t==="aluminum_blind"&&(m="defaults_aluminum_blind_price_sqyd"),m&&(c=u.querySelector(`[name="${m}"]`))}}else a&&(c=a.querySelector('[name="force_apply_price"]'));const i=c;r.value=l,r.classList.add("input-highlight"),setTimeout(()=>{r&&r.classList.remove("input-highlight")},1200),i&&d>=0&&(i.tagName==="SELECT"?Array.from(i.options).some(u=>h(u.value)===d)?i.value=d:q(`‡∏£‡∏≤‡∏Ñ‡∏≤ ${E(d)} ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å`,"warning"):i.value=d===0?"0":d>0?E(d):"",i.classList.add("input-highlight"),setTimeout(()=>{i&&i.classList.remove("input-highlight")},1200)),o?((i||r).dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),i&&i.matches('input[inputmode="numeric"]')&&i.dispatchEvent(new Event("blur",{bubbles:!0,cancelable:!0}))):(s||a)&&i&&i.matches('input[inputmode="numeric"]')&&i.dispatchEvent(new Event("blur",{bubbles:!0,cancelable:!0}));const f=document.querySelector("#favoritesModal");f&&typeof f.closeModal=="function"&&f.closeModal({cancelled:!1,applied:!0})}async function To(e){if(!e||!e.dataset.favoriteType){console.warn("showFavoritesModal called without a valid input element or favorite type.");return}tt(e);const n=e.dataset.favoriteType;if(!n){q("‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô","warning");const b=e.closest("#forceApplyModal");b&&b.querySelector("#forceApplySelectTypeBtn")?.focus(),tt(null);return}const s=document.querySelector("#favoritesModal"),o=s.querySelector("#favoritesModalTitle"),a=s.querySelector("#favoritesModalBody"),r=s.querySelector("#favSearchInput"),c=s.querySelector('[data-act="manage-favorites"]'),t=document.querySelector("#favSelectorItemTpl");if(!s||!o||!a||!r||!c||!t){console.error("Missing elements for favorites modal");return}let l=W[n]?.name||n;n==="fabric"?l="‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö":n==="sheer"&&(l="‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á"),o.textContent=`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å '${C(l)}'`;const d=()=>{const p=ge()[n]||[];p.length>0?a.innerHTML=p.map(y=>{let v="-";return y.price>=0&&(v=E(y.price)),t.innerHTML.replace(/{CODE}/g,C(y.code)).replace(/{PRICE}/g,v).replace(/{RAW_PRICE}/g,y.price)}).join(""):a.innerHTML='<p class="empty-state">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</p>',r.value=""};d();const i=()=>{const b=r.value.toLowerCase();a.querySelectorAll(".fav-selector-item").forEach(p=>{const y=p.dataset.code.toLowerCase();p.classList.toggle("is-hidden",!y.includes(b))})},f=b=>{const p=b.target.closest(".fav-selector-item");p&&Mo(p)},u=async()=>{await Io(n),Ao()&&d()},m=()=>{r.removeEventListener("input",i),a.removeEventListener("click",f),c&&(c.onclick=null)};r.addEventListener("input",i),a.addEventListener("click",f),c.onclick=u,await J("#favoritesModal",m)}function Oe(e){const n=document.querySelector("#favManagerBody"),s=document.querySelector("#favManagerItemTpl"),a=ge()[e]||[];if(!n||!s)return;a.length===0?n.innerHTML='<p class="empty-state">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</p>':n.innerHTML=a.map(t=>{let l="-";return t.price>=0&&(l=E(t.price)),s.innerHTML.replace(/{CODE}/g,C(t.code)).replace(/{PRICE}/g,l).replace(/{RAW_PRICE}/g,t.price)}).join(""),We(null);const r=document.querySelector('#favManagerModal [data-act="edit-selected-fav"]'),c=document.querySelector('#favManagerModal [data-act="del-selected-fav"]');r&&(r.disabled=!0),c&&(c.disabled=!0)}async function Io(e){const n=document.querySelector("#favManagerModal");if(!n||!e)return;let s=W[e]?.name||e;e==="fabric"?s="‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö":e==="sheer"&&(s="‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á"),n.dataset.currentType=e,He(!1),We(null),document.querySelector("#favManagerTitle").textContent=`‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ '${C(s)}'`,Oe(e),await J("#favManagerModal")}let re={...ye};function Be(){return re}function Co(e){try{const n={...ye,...e};e.pdf&&e.pdf.notes?n.pdf.notes=e.pdf.notes:n.pdf.notes=ye.pdf.notes,re=n,localStorage.setItem(qt,JSON.stringify(n)),console.log("Shop config saved.")}catch(n){console.error("Failed to save shop config:",n),q("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ","error")}}function Tt(){try{const e=localStorage.getItem(qt);if(e){const n=JSON.parse(e);re={...ye,...n},n.pdf&&(re.pdf={...ye.pdf,...n.pdf}),console.log("Shop config loaded from localStorage.")}else re={...ye},console.log("No local shop config found, using defaults.")}catch(e){console.error("Failed to load/parse shop config:",e),re={...ye}}}function St(){const e=document.querySelector(_.shopSettingsForm);e&&(e.elements.shop_name.value=re.name||"",e.elements.shop_address.value=re.address||"",e.elements.shop_phone.value=re.phone||"",e.elements.shop_taxid_email.value=re.taxId||"",e.elements.shop_pdf_notes.value=(re.pdf.notes||[]).join(`
`))}function Bo(){const e=document.querySelector(_.shopSettingsForm);if(!e)return;const n=e.elements.shop_name.value.trim();if(!n){q("‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤","error"),e.elements.shop_name.focus();return}const s=e.elements.shop_pdf_notes.value.split(`
`).map(r=>r.trim()).filter(r=>r.length>0),o={...re,name:n,address:e.elements.shop_address.value.trim(),phone:e.elements.shop_phone.value.trim(),taxId:e.elements.shop_taxid_email.value.trim(),pdf:{...re.pdf,notes:s}};Co(o),q("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß","success");const a=document.querySelector(_.shopSettingsModal);a&&typeof a.closeModal=="function"&&a.closeModal()}const Q=[];let se=!1,Re=null,we=null;const wt=document.querySelector("#undoBtn"),et="marnthara.theme";let It=null;const Me=()=>It,Eo=e=>{It=e};let Ct=!1;const Ao=()=>Ct,He=e=>{Ct=e};let Bt=null;const ae=()=>Bt,We=e=>{Bt=e};let Et=null;const Po=()=>Et,tt=e=>{Et=e};let At=null;const Pt=()=>At,Dt=e=>{At=e};let nt=[];const rt=()=>nt,Rt=()=>{nt=[]},Qe=e=>{nt.push(e)},Ne={};function Do(e){if(Ne[e])return Ne[e];const n=new Promise((s,o)=>{const a=document.createElement("script");a.src=e,a.onload=()=>s(),a.onerror=()=>{console.error(`Script load error for ${e}`),delete Ne[e],o(new Error(`Script load error for ${e}`))},document.head.appendChild(a)});return Ne[e]=n,n}function Nt(){const e=localStorage.getItem(et),n=document.querySelector("#themeToggleBtn");if(!n)return;const s=n.querySelector("i"),o=n.querySelector("span");switch(document.body.classList.remove("dark-theme","neutral-theme"),e){case"dark":document.body.classList.add("dark-theme"),s&&(s.className="ph-fill ph-sun"),o&&(o.textContent=" Theme ‡∏™‡∏ß‡πà‡∏≤‡∏á");break;case"neutral":document.body.classList.add("neutral-theme"),s&&(s.className="ph-fill ph-moon"),o&&(o.textContent="Theme ‡∏°‡∏∑‡∏î");break;default:s&&(s.className="ph-fill ph-palette"),o&&(o.textContent="Theme ‡∏Å‡∏•‡∏≤‡∏á");break}}function Ro(){const e=localStorage.getItem(et);let n="neutral";!e||e==="light"?n="neutral":e==="neutral"?n="dark":n="light",localStorage.setItem(et,n),Nt()}function oe(){wt&&(wt.disabled=!Xt())}function No(){const e=Kt();e&&(lt(e,!1),q("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß","success")),oe()}function qe(){const e=document.getElementById("suspendedItemsBtn");if(!e)return;if(we){e.classList.remove("is-visible");return}const n=document.getElementById("suspendedCountBadge"),s=document.querySelectorAll(".item-card.is-suspended:not(.placeholder-item)").length,o=document.querySelectorAll(".room-card.is-suspended");let a=0;o.forEach(c=>{a+=c.querySelectorAll(".item-card:not(.is-suspended):not(.placeholder-item)").length});const r=s+a;n&&(n.textContent=r),e.classList.toggle("is-visible",r>0)}function Ke(){we="suspended";const e=document.getElementById("filterStatusBar");let n=0;if(document.querySelectorAll(".room-card").forEach(o=>{let a=!1;const r=o.classList.contains("is-suspended");o.querySelectorAll(".item-card").forEach(t=>{const d=t.classList.contains("is-suspended")||r;t.classList.toggle("item-hidden",!d),d&&(a=!0,t.classList.contains("placeholder-item")||n++)});const c=r||a;o.classList.toggle("item-hidden",!c)}),document.querySelectorAll(".item-card.is-suspended:not(.placeholder-item)").length+Array.from(document.querySelectorAll(".room-card.is-suspended .item-card:not(.is-suspended):not(.placeholder-item)")).length===0){Ft(),q("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏£‡∏∞‡∏á‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß","success");return}e&&(e.innerHTML=`
            <span><i class="ph ph-warning"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏£‡∏∞‡∏á‡∏±‡∏ö (${n} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</span>
            <button type="button" class="btn-chip" data-act="clear-filter" title="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á">
                <i class="ph ph-x"></i>&nbsp;‡∏õ‡∏¥‡∏î
            </button>
        `,e.classList.add("is-visible"),e.dataset.filterType="suspended"),le(),pe(),qe()}function Fo(e,n){if(!e)return;we=e;const s=document.getElementById("filterStatusBar");let o=0;document.querySelectorAll(_.room).forEach(a=>{let r=0;a.querySelectorAll(".item-card").forEach(c=>{const t=c.dataset.type===e&&!c.classList.contains("placeholder-item");c.classList.toggle("item-hidden",!t),t&&r++}),a.querySelectorAll(".placeholder-item").forEach(c=>c.classList.toggle("item-hidden",r===0)),a.classList.toggle("item-hidden",r===0),r>0&&(o+=r)}),s&&(s.innerHTML=`
            <span>‡πÄ‡∏â‡∏û‡∏≤‡∏∞: <strong>${C(n)}</strong> (${o} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</span>
            <button type="button" class="btn-chip" data-act="clear-filter" title="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á">
                <i class="ph ph-x"></i>&nbsp;‡∏õ‡∏¥‡∏î
            </button>
        `,s.classList.add("is-visible"),s.dataset.filterType=e),le(),pe(),qe()}function Ft(){we=null;const e=document.getElementById("filterStatusBar");e&&(e.classList.remove("is-visible"),e.innerHTML="",e.removeAttribute("data-filter-type")),document.querySelectorAll(".item-hidden").forEach(n=>n.classList.remove("item-hidden")),le(),pe(),qe()}function q(e,n="default"){const s=document.querySelector(_.toastContainer);if(!s)return;const o={success:"ph-bold ph-check-circle",warning:"ph-bold ph-warning",error:"ph-bold ph-x-circle",default:"ph-bold ph-info"},a=document.createElement("div");a.className=`toast toast-${n}`,a.innerHTML=`<i class="${o[n]||o.default}"></i> ${C(e)}`,s.appendChild(a),setTimeout(()=>a.classList.add("show"),10),setTimeout(()=>{a.classList.remove("show"),a.addEventListener("transitionend",()=>a.remove())},3e3)}function J(e,n={}){const{onCancel:s,persistent:o=!1}=typeof n=="function"?{onCancel:n}:n;return new Promise(a=>{const r=document.querySelector(e);if(!r){console.error("Modal not found:",e),a(null);return}if(Q.length>0){const p=Q[Q.length-1];p&&p.classList.contains("visible")&&p.classList.add("is-underlay")}Q.push(r),r.classList.add("visible"),o&&r.classList.add("modal-persistent");const c=r.querySelector('[id$="Confirm"]'),t=r.querySelector('[id$="Cancel"], [data-act="close-modal"], #roomDefaultsCancelBtn, #manageFavsTypeCancel, #forceApplyCancel, #forceApplyTypeCancel, #dimensionEntryCancel'),l=r.querySelector("#itemTypeModalMultiAdd"),d=Array.from(r.querySelectorAll('button, [href], input:not([type="hidden"]), select, textarea, [tabindex]:not([tabindex="-1"])')).filter(p=>!p.disabled&&p.offsetParent!==null),i=d[0],f=d[d.length-1];setTimeout(()=>i?.focus(),50);const u=p=>{r.classList.remove("visible"),r.classList.remove("modal-persistent"),document.removeEventListener("keydown",m),r.removeEventListener("click",b),l&&(l.onclick=null),c&&(c.onclick=null),t&&(t.onclick=null),r.closeModal===u&&(r.closeModal=null);const y=Q.pop();y!==r&&(console.error(`[cleanup] Modal stack mismatch! Expected #${r.id}, but popped #${y?.id}. Resetting stack.`),Q.length=0);const v=Q.length>0?Q[Q.length-1]:null;v&&v.classList.contains("visible")&&v.classList.remove("is-underlay"),e==="#roomControlCenterModal"&&(rt().forEach(({element:k,event:L,handler:B})=>{k.removeEventListener(L,B)}),Rt(),Dt(null)),e==="#favoritesModal"&&tt(null),p?.cancelled&&typeof s=="function"&&s(),a(p)};r.closeModal=u;const m=p=>{const y=Q.length>0&&Q[Q.length-1]===r;p.key==="Escape"&&y&&!o&&u({cancelled:!0}),p.key==="Tab"&&d.length>1&&(p.shiftKey?document.activeElement===i&&(f.focus(),p.preventDefault()):document.activeElement===f&&(i.focus(),p.preventDefault()))},b=p=>{const y=Q.length>0&&Q[Q.length-1]===r;p.target===r&&y&&!o&&(p.stopPropagation(),u({cancelled:!0}))};c&&(c.onclick=()=>u(!0)),t&&(t.onclick=()=>{Q.length>0&&Q[Q.length-1]===r&&!o&&u({cancelled:!0})}),document.addEventListener("keydown",m),l&&(l.onclick=()=>u({multiAdd:!0})),r.addEventListener("click",b)})}async function de(e,n){const s=document.querySelector(_.modal);return s?(s.querySelector(_.modalTitle).textContent=e,s.querySelector(_.modalBody).textContent=n,await J(_.modal)===!0):!0}function Xe(e,n){e&&(ue(K()),oe(),e.classList.add("item-removing"),e.addEventListener("animationend",()=>{e.remove(),q(n),Ue(),le(),X(),Ee()},{once:!0}))}function st(e){if(!e)return;const n=document.querySelector(".main-header");if(!n){e.scrollIntoView({behavior:"smooth",block:"center"});return}const s=n.offsetHeight,o=16,r=(e.querySelector(".item-header")||e).getBoundingClientRect(),c=s+o,t=r.top-c;Math.abs(t)>5&&window.scrollBy({top:t,behavior:"smooth"})}function he(e){if(!e)return;const n=document.querySelector(".main-header"),s=document.querySelector(".summary-footer"),o=n?n.offsetHeight+16:80,a=s?s.offsetHeight+16:100;requestAnimationFrame(()=>{const r=e.getBoundingClientRect(),c=window.innerHeight;if(!(r.top>=o&&r.bottom<=c-a)){const l=c-o-a,d=r.height>l?"start":"center";e.scrollIntoView({behavior:"smooth",block:d})}})}function le(){document.querySelectorAll(_.room).forEach(e=>{const n=e.querySelectorAll(".item-card:not(.item-hidden)");let s=0;const o=Array.from(n).filter(a=>!a.classList.contains("is-suspended")&&!a.classList.contains("placeholder-item")).length;n.forEach(a=>{const r=a.querySelector("[data-item-title]");r&&(a.classList.contains("placeholder-item")?r.textContent="...":a.classList.contains("is-suspended")?r.textContent="-":(s++,r.textContent=`${s}/${o}`))}),e.querySelectorAll(".item-card.item-hidden").forEach(a=>{const r=a.querySelector("[data-item-title]");r&&(r.textContent="-")})})}function Ot(){const e=document.querySelector(_.orderForm),n=document.querySelector(_.lockBtn);!e||!n||(e.classList.toggle("is-locked",se),n.classList.toggle("is-locked",se),n.querySelector("i").className=se?"ph-bold ph-lock-key":"ph ph-paw-print",e.querySelectorAll('input:not([type="hidden"]), select, textarea, button:not(.unlockable):not([data-act="toggle-more-details"]):not([data-act="collapse-room"])').forEach(s=>{!s.closest(".main-header")&&!s.closest(".summary-footer")&&!s.closest(".modal-wrapper")&&(s.disabled=se)}),document.querySelectorAll(".unlockable").forEach(s=>s.disabled=!1))}function Oo(){se=!se,Ot(),q(se?"‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ":"‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡πâ‡∏ß",se?"warning":"success")}function pe(){const e=document.querySelectorAll(_.room+":not(.item-hidden)");if(e.length===0){const o=document.querySelector(_.toggleAllRoomsBtn);o&&(o.querySelector("i").className="ph ph-caret-down",o.querySelector("span").textContent="‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î");return}const n=[...e].some(o=>o.open),s=document.querySelector(_.toggleAllRoomsBtn);s&&(s.querySelector("i").className=n?"ph ph-caret-up":"ph ph-caret-down",s.querySelector("span").textContent=n?"‡∏¢‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î":"‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î")}function Ho(){const e=document.querySelectorAll(_.room+":not(.item-hidden)");if(e.length===0)return;const n=[...e].some(o=>o.open);e.forEach(o=>{o.open=!n});const s=document.querySelector(_.quickNavDropdown);s&&s.classList.contains("show")&&(s.classList.remove("show"),document.querySelector(_.quickNavBtn)?.setAttribute("aria-expanded","false")),setTimeout(()=>{pe(),ne()},50)}function Ue(){const e=document.querySelector(_.quickNavRoomList);e&&(e.innerHTML="",document.querySelectorAll(_.room).forEach(n=>{const s=n.querySelector(_.roomNameInput)?.value||"‡∏´‡πâ‡∏≠‡∏á",o=document.createElement("a");o.href=`#${n.id}`,o.dataset.jumpTo=n.id,o.innerHTML=`<i class="ph ph-share-fat"></i> ${C(s)||"‡∏´‡πâ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)"}`,e.appendChild(o)}))}function ze(e){const n=document.getElementById("quickNavBtnText");n&&(e?n.textContent=e.querySelector('input[name="room_name"]')?.value||"...":n.textContent="‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡πâ‡∏≠‡∏á")}function Ee(){if(Re&&Re.disconnect(),!document.getElementById("quickNavBtnText"))return;const n={root:null,rootMargin:"-60px 0px -150px 0px",threshold:0},s=a=>{const r=a.filter(c=>c.isIntersecting).sort((c,t)=>c.target.getBoundingClientRect().top-t.target.getBoundingClientRect().top);r.length>0&&ze(r[0].target)};Re=new IntersectionObserver(s,n),document.querySelectorAll(_.room).forEach(a=>Re.observe(a));const o=Array.from(document.querySelectorAll(_.room));if(o.length>0){o.sort((r,c)=>r.getBoundingClientRect().top-c.getBoundingClientRect().top);const a=o.find(r=>r.getBoundingClientRect().bottom>60);ze(a||o[0])}else ze(null)}function je(e,n=null){if(!e||e.classList.contains("placeholder-item"))return;const s=e.querySelector(".item-details-more"),o=e.querySelector('[data-act="toggle-more-details"]'),a=o?.parentElement;if(!s||!o||!a)return;const r=s.classList.contains("show"),c=n!==null?n:!r;if(r===c)return;s.classList.toggle("show",c),o.classList.toggle("expanded",c);const t=o.querySelector("i"),l=o.querySelector("span");if(t&&(t.className=c?"ph ph-caret-up":"ph ph-caret-down"),l)if(c)l.textContent="‡∏¢‡πà‡∏≠‡∏ô‡πâ‡∏≠‡∏¢‡∏•‡∏á";else{const d=o.dataset.priceSummary;d?l.innerHTML=`‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° <small>(${d})</small>`:l.textContent="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"}if(c)s.appendChild(a),setTimeout(()=>st(e),100);else{const d=e.querySelector(".item-grid");d&&d.appendChild(a)}}function Ht(e){if(!e||!e.matches(_.itemCard)||e.classList.contains("placeholder-item"))return null;const n=e.dataset.type;if(!n)return null;let s={type:n,is_suspended:e.classList.contains("is-suspended"),enable_set_price:e.querySelector('[name="enable_set_price"]')?.checked||!1,set_price_override:h(e.querySelector('[name="set_price_override"]')?.value)};try{if(n==="set")Object.assign(s,{width_m:h(e.querySelector(_.setWidthInput)?.value),height_m:h(e.querySelector(_.setHeightInput)?.value),style:e.querySelector(_.setStyleSelect)?.value||"",fabric_variant:e.querySelector(_.setFabricVariantSelect)?.value||"",price_per_m_raw:h(e.querySelector(_.setPricePerMSelect)?.value),sheer_price_per_m:h(e.querySelector(_.setSheerPricePerMSelect)?.value),louis_price_per_m:h(e.querySelector('select[name="louis_price_per_m"]')?.value),fabric_code:e.querySelector(_.setFabricCodeInput)?.value||"",sheer_fabric_code:e.querySelector(_.setSheerCodeInput)?.value||"",opening_style:e.querySelector(_.setOpeningStyleSelect)?.value||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á",adjustment_side:e.querySelector(_.setAdjustmentSideSelect)?.value||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤",track_color:e.querySelector('input[name="track_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",bracket_color:e.querySelector('input[name="bracket_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",finial_color:e.querySelector('input[name="finial_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",grommet_color:e.querySelector('input[name="grommet_color"]')?.value||"‡πÄ‡∏á‡∏¥‡∏ô",louis_valance:e.querySelector('input[name="louis_valance"]')?.value||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",louis_tassels:e.querySelector('input[name="louis_tassels"]')?.value||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤",notes:e.querySelector(_.setNotesInput)?.value||""});else if(n==="removal")Object.assign(s,{quantity:h(e.querySelector('input[name="quantity"]')?.value),price_per_item:h(e.querySelector('input[name="price_per_item"]')?.value),description:e.querySelector('input[name="description"]')?.value||"",notes:e.querySelector('input[name="notes"]')?.value||""});else if(n==="wallpaper"){const o=e.querySelector(_.wallInstallCostInput),a=o?o.value:"";let r;a==="0"?r=0:typeof a=="number"&&a>0?r=a:h(a)>0&&(r=h(a)),Object.assign(s,{height_m:h(e.querySelector(_.wallHeightInput)?.value),wallpaper_code:e.querySelector(_.wallCodeInput)?.value||"",price_per_roll:h(e.querySelector(_.wallPriceRollInput)?.value),install_cost_per_roll:r,notes:e.querySelector(_.wallNotesInput)?.value||"",widths:Array.from(e.querySelectorAll(_.wallWidthInput)).map(c=>h(c.value))})}else e.matches(_.areaBasedItem)&&(Object.assign(s,{width_m:h(e.querySelector(_.areaWidthInput)?.value),height_m:h(e.querySelector(_.areaHeightInput)?.value),price_sqyd:h(e.querySelector(_.areaPriceSqydInput)?.value),code:e.querySelector(_.areaCodeInput)?.value||"",notes:e.querySelector(_.areaNotesInput)?.value||""}),(n==="partition"||n==="pleated_screen")&&(s.opening_style=e.querySelector('select[name="opening_style"]')?.value||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"),["wooden_blind","roller_blind","vertical_blind","aluminum_blind"].includes(n)&&(s.adjustment_side=e.querySelector('select[name="adjustment_side"]')?.value||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤"));return s}catch(o){return console.error("Failed to extract item data:",o,e),null}}const X=$e(()=>{let e=0;document.querySelectorAll(_.room).forEach(i=>{let f=0,u=0;const m=i.classList.contains("is-suspended");if(m||(i.querySelectorAll(".item-card:not(.is-suspended):not(.placeholder-item)").forEach(b=>{const p=h(b.dataset.totalPrice);p>0&&(f+=p,u++)}),e+=f),typeof i.updateBrief=="function"){const b=i.querySelectorAll(".placeholder-item:not(.is-suspended)").length;if(m)i.updateBrief("(‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)");else if(u>0){let p=`<span>${u}</span> &bull; ${E(f)} ‡∏ö‡∏≤‡∏ó`;b>0&&(p+=` (+${b} ‡∏£‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)`),i.updateBrief(p)}else b>0?i.updateBrief(`<span>${b}</span> ‡∏£‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó`):i.updateBrief("<span>0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£")}});const n=document.querySelector("#discount_type"),s=document.querySelector("#discount_value"),o=n?n.value:"amount",a=s?h(s.value):0;let r=0;a>0&&(r=o==="percent"?e*(a/100):a,r=Math.min(e,r));let c=e-r;const t=document.querySelector("#grandTotal"),l=document.querySelector("#vat_enabled");l&&l.value==="1"&&(c=c*(1+Be().baseVatRate));const d=document.querySelector("#originalTotal");t&&(t.textContent=E(c)),d&&(d.dataset.rawTotal=e,r>0?(d.textContent=E(e),d.style.display="block"):d.style.display="none"),qe(),ne()},200);async function lt(e,n=!1){if(!e){q("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","error");return}if(n||Tt(),e.favorites)if(n){const d=document.querySelector("#favoritesConflictModal");if(d){const i=d.querySelector('input[name="fav_conflict_option"][value="merge"]');i&&(i.checked=!0);const f=await J("#favoritesConflictModal");if(!f||f.cancelled){q("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤","warning");return}const u=d.querySelector('input[name="fav_conflict_option"]:checked').value;let m=0;switch(u){case"overwrite":dt(e.favorites)&&q("‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success");break;case"merge":m=Ze(e.favorites),q(`‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏û‡∏¥‡πà‡∏° ${m} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà)`,"success");break;case"skip":q("‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î","default");break}}else Ze(e.favorites)}else dt(e.favorites);const s=document.querySelector(_.roomsContainer);if(!s)return;s.innerHTML="";const o=document.querySelector("#customer_name"),a=document.querySelector("#customer_phone"),r=document.querySelector("#customer_address"),c=document.querySelector("#customerDetailsCard");o&&(o.value=e.customer_name||""),a&&(a.value=e.customer_phone||""),r&&(r.value=e.customer_address||""),c&&(c.open=e.customer_card_open??!0);const t=document.querySelector("#discount_type"),l=document.querySelector("#discount_value");if(e.discount&&t&&l?(t.value=e.discount.type||"amount",l.value=e.discount.value||0):t&&l&&(t.value="amount",l.value=0),!Array.isArray(e.rooms)){q("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå","warning"),s.children.length===0&&Se();return}for(const d of e.rooms){const i=Lt(d);if(!i)continue;s.appendChild(i);const f=i.getItemsContainer();if(f&&Array.isArray(d.items))for(const u of d.items){let m;if(u.type==="placeholder"){const b=document.querySelector("#placeholderItemTpl");if(b){m=b.content.cloneNode(!0).firstElementChild,m.dataset.widthM=u.width_m||0,m.dataset.heightM=u.height_m||0;const y=m.querySelector("[data-placeholder-width]"),v=m.querySelector("[data-placeholder-height]");y&&(y.textContent=ee(u.width_m)),v&&(v.textContent=ee(u.height_m)),u.is_suspended&&m.classList.add("is-suspended")}else{console.warn("Placeholder template not found during load.");continue}}else if(u.type==="set")m=ke(u);else if(u.type==="wallpaper")m=xe(u);else if(u.type==="removal")m=Ce(u);else if(W[u.type]?.templateId==="#areaBasedTpl")m=Le(u.type,u);else continue;m&&f.appendChild(m)}}le(),Ue(),pe(),Ee(),oe(),X(),n&&q("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}async function jo(e,n){const s=document.querySelector(_.printableContent);if(!s||!e){q("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£","error");return}const o=document.title;if(n==="direct"){q("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á PDF...","default");let a;try{typeof window.html2pdf>"u"&&(q("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ PDF...","default"),await Do("https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js")),a=document.createElement("div"),a.style.position="fixed",a.style.left="-300mm",a.style.top="0",a.style.width="210mm",a.style.background="#fff",a.innerHTML=e,document.body.appendChild(a),await new Promise(c=>setTimeout(c,300));const r={margin:0,filename:`${o}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,logging:!1,width:a.querySelector(".pdf-page")?.scrollWidth||794,windowWidth:a.querySelector(".pdf-page")?.scrollWidth||794},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};await window.html2pdf().from(a).set(r).save(),q("‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch(r){console.error("PDF Generation Error:",r),q("‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß, ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2 (‡∏û‡∏¥‡∏°‡∏û‡πå)","error")}finally{a&&document.body.contains(a)&&document.body.removeChild(a)}}else n==="print"&&(s.innerHTML=e,setTimeout(()=>{window.print(),setTimeout(()=>{s.innerHTML=""},1e3)},Wt))}function Wo(e){if(!e||!e.html){q("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå HTML","error");return}try{const n=`<!DOCTYPE html><html lang="th"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>${e.fileName}</title><link rel="stylesheet" href="./src/styles/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/bold/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css"><style>body { background-color: #eee; } #printable-content { display: block !important; max-width: 210mm; margin: 10mm auto; } .pdf-page { border: 1px solid #ccc; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 10mm; background: #fff; page-break-inside: avoid; } .pdf-page-content { padding: 12mm; } @media print { body { background-color: #fff; } #printable-content { max-width: 100%; margin: 0; } .pdf-page { border: none; box-shadow: none; margin-bottom: 0; page-break-after: always; } .pdf-page:last-child { page-break-after: avoid; } } i.ph { vertical-align: middle; }</style></head><body><div id="printable-content">${e.html}</div></body></html>`,s=new Blob([n],{type:"text/html;charset=utf-8"}),o=URL.createObjectURL(s),a=document.createElement("a");a.href=o,a.download=`${e.fileName}.html`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o),q("‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå HTML ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch(n){console.error("HTML Export Error:",n),q("‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå HTML ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}function Vo(){const e=document.querySelector(_.orderForm),n=document.querySelector(_.fileImporter),s=document.querySelector("#favImporter"),o=document.querySelector(_.menuDropdown),a=document.querySelector(_.quickNavDropdown),r=document.querySelector(_.menuBtn),c=document.querySelector(_.quickNavBtn);if(e){if(e.addEventListener("item-update",X),e.addEventListener("input",t=>{if(se){t.preventDefault();return}if(t.target.closest("#customerInfo")&&ne(),t.target.matches(_.roomNameInput)){const d=t.target.closest(".room-card")?.querySelector("[data-room-name-display]");d&&(d.textContent=t.target.value||"‡∏´‡πâ‡∏≠‡∏á"),Ue(),Ee(),$e(ne,300)()}t.target.matches('input[name$="_m"], input[name$="price_sqyd"], input[name$="price_roll"], input[name$="install_cost"]')&&X()}),e.addEventListener("change",t=>{if(se){t.preventDefault();return}t.target.matches("select")&&X()}),e.addEventListener("blur",t=>{const l=t.target;l.matches('[name$="_price_sqyd"], [name$="_price_roll"], [name$="_install_cost"], [name="price_per_item"], [name="set_price_override"]')?(l.name==="wallpaper_install_cost"||l.name==="set_price_override")&&h(l.value)===0?l.value="0.00":l.value=h(l.value)>0?E(h(l.value),2):"":l.matches('input[name$="_m"], input[name^="wall_width_m"], input[name^="modal_"]')&&(l.value=ee(l.value)),!l.closest(".modal-wrapper")&&l.matches('input:not([type="hidden"]), select, textarea')&&ne()},!0),e.addEventListener("focusin",t=>{const l=t.target;if(l.matches('[name$="_price_sqyd"], [name$="_price_roll"], [name$="_install_cost"], [name="price_per_item"], [name="set_price_override"]')&&((l.name==="wallpaper_install_cost"||l.name==="set_price_override")&&(l.value==="0"||l.value==="0.00")||h(l.value)>0&&(l.value=h(l.value))),l.matches('input:not([type="hidden"]), select, textarea')){const i=document.querySelector(".main-header"),f=document.querySelector(".summary-footer"),u=i?i.offsetHeight+16:80,m=f?f.offsetHeight+16:100,b=window.innerHeight,p=l.getBoundingClientRect();if((p.top<u||p.bottom>b-m)&&!l.closest(".modal-wrapper")){const v=l.closest(".item-card, .room-card");v&&he(v)}}},!0),e.addEventListener("keydown",t=>{if(se){t.preventDefault();return}const l=t.target;if(t.key==="Enter"&&l.matches("input, select")&&!l.closest(".modal-wrapper")){t.preventDefault();const d=l.closest(".item-card, .card");if(d){const i=Array.from(d.querySelectorAll('input:not([type="hidden"]):not([disabled]), select:not([disabled]), textarea:not([disabled])')).filter(u=>u.offsetParent!==null&&!u.closest(".hidden")&&(!u.closest(".item-details-more")||u.closest(".item-details-more.show"))),f=i.indexOf(l);if(f>-1&&f<i.length-1){const u=i[f+1];u.focus(),typeof u.select=="function"&&u.select()}else f===i.length-1&&l.blur()}}else if(t.key==="Enter"&&l.closest("#dimensionEntryModal")){t.preventDefault();const d=l.closest("#dimensionEntryModal"),i=Array.from(d.querySelectorAll('input[name="modal_width_m"], input[name="modal_height_m"]')),f=i.indexOf(l);if(f>-1&&f<i.length-1){const u=i[f+1];u.focus(),u.select()}else f===i.length-1&&(d.querySelector('[data-act="add-dimension-row"]')?.click(),setTimeout(()=>{const m=d.querySelectorAll(".dimension-input-row");m[m.length-1].querySelector('input[name="modal_width_m"]')?.focus()},50))}}),document.addEventListener("click",async t=>{t.target.closest(".menu-container")||(o?.classList.remove("show"),r?.setAttribute("aria-expanded","false"),a?.classList.remove("show"),c?.setAttribute("aria-expanded","false")),t.target.closest(".room-options-container")||document.querySelectorAll(".room-options-menu.show").forEach(f=>f.classList.remove("show"));const l=t.target.closest(".summary-tag[data-filter-type]");if(l&&l.closest("#overviewModal")){const f=l.dataset.filterType,u=l.textContent.trim().replace(/\s*\d+\s*$/,""),m=document.querySelector("#overviewModal");m&&typeof m.closeModal=="function"&&m.closeModal({cancelled:!0}),Fo(f,u);return}const d=t.target.closest(".fav-manager-item");if(d){const f=d.closest("#favManagerModal"),u=f?.querySelector(".fav-manager-item.is-selected");u&&u.classList.remove("is-selected"),u!==d?(d.classList.add("is-selected"),We({code:d.dataset.code,price:h(d.dataset.price)})):We(null),f&&(f.querySelector('[data-act="edit-selected-fav"]').disabled=!ae(),f.querySelector('[data-act="del-selected-fav"]').disabled=!ae());return}if(t.target.closest('[data-act="batch-select-type"]')){const f=t.target.closest('[data-act="batch-select-type"]'),u=document.querySelector(f.dataset.targetDisplay),m=document.getElementById("batch-select-device-type-value"),b=m?.value||"all",p=await gt(b,!0);p&&(m.value=p.type==="all"?"":p.type,u&&(u.textContent=p.displayName),f.classList.toggle("is-placeholder",p.type==="all"||!p.type),document.dispatchEvent(new CustomEvent("batch-type-filter-change",{detail:{type:p.type}})));return}if(t.target.closest('[data-act="batch-select-target-type"]')){const f=t.target.closest('[data-act="batch-select-target-type"]'),u=document.querySelector(f.dataset.targetDisplay),m=document.getElementById("batch-target-device-type-value"),b=m?.value||null,p=await gt(b,!1);p&&(m.value=p.type,u&&(u.textContent=p.displayName),f.classList.remove("is-placeholder"),m.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!1})));return}const i=t.target.closest("[data-act]");if(i){const f=i.dataset.act,u=i.closest(".item-card"),m=i.closest(".room-card"),b=["toggle-more-details","collapse-room","show-discount-modal","show-suspended-items","clear-filter","close-modal","jump-to-item","manage-favorites","show-favorites","open-shop-settings","save-shop-config"];if(se&&!i.closest(".unlockable")&&!b.includes(f)){q("‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¢‡∏π‡πà","warning");return}switch(["toggle-more-details","close-modal","collapse-room","remove-dimension-row"].includes(f)||t.preventDefault(),f!=="close-modal"&&t.stopPropagation(),f){case"open-shop-settings":{document.querySelector(_.shopSettingsModal)&&(St(),J(_.shopSettingsModal));break}case"save-shop-config":Bo();break;case"show-discount-modal":mo();break;case"show-suspended-items":Ke();break;case"clear-filter":Ft();break;case"add-room":Se();break;case"add-item":{if(!m)break;const p=document.querySelector("#itemTypeModal");if(!p)break;p.querySelector("#itemTypeModalTitle").textContent="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",p.querySelector('label[data-item-type="all"]')?.style.setProperty("display","none");let y=p.querySelector('input[name="item_type_option"][value="set"]');y&&(y.checked=!0);const v=await J("#itemTypeModal");if(!v||v.cancelled)break;if(v.multiAdd){const k=document.querySelector("#dimensionEntryModal");if(k){const L=k.querySelector("#dimensionRowsContainer");L.innerHTML="";const B=vt();L.appendChild(B),B.querySelector('input[name="modal_width_m"]')?.focus();const R=await J("#dimensionEntryModal");if(R&&!R.cancelled){const x=[];if(L.querySelectorAll(".dimension-input-row").forEach(P=>{const j=P.querySelector('input[name="modal_width_m"]'),H=P.querySelector('input[name="modal_height_m"]'),S=h(j.value),w=h(H.value);S>0&&w>0&&x.push({width_m:S,height_m:w})}),x.length>0){ue(K()),oe();let P=null;x.forEach(j=>{const H=qo(j,m);P||(P=H)}),P&&(le(),ne(),he(P),q(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${x.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏£‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó)`,"success"))}else q("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏","warning")}}break}if(v===!0){const k=p.querySelector('input[name="item_type_option"]:checked')?.value;if(!k){q("‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó","warning");break}ue(K()),oe();const L=JSON.parse(m.dataset.roomDefaults||"{}");let B={};const R=j=>L[`enable_defaults_${j}`]===!0;switch(k){case"set":R("set")&&(B.fabric_code=L.defaults_fabric_code,B.price_per_m_raw=L.defaults_fabric_price,B.sheer_fabric_code=L.defaults_sheer_code,B.sheer_price_per_m=L.defaults_sheer_price);break;case"wallpaper":R("wallpaper")&&(B.wallpaper_code=L.defaults_wallpaper_code,B.price_per_roll=L.defaults_wallpaper_price_roll,B.install_cost_per_roll=L.defaults_wallpaper_install_cost);break;case"wooden_blind":R("wooden_blind")&&(B.code=L.defaults_wooden_blind_code,B.price_sqyd=L.defaults_wooden_blind_price_sqyd);break;case"roller_blind":R("roller_blind")&&(B.code=L.defaults_roller_blind_code,B.price_sqyd=L.defaults_roller_blind_price_sqyd);break;case"vertical_blind":R("vertical_blind")&&(B.code=L.defaults_vertical_blind_code,B.price_sqyd=L.defaults_vertical_blind_price_sqyd);break;case"partition":R("partition")&&(B.code=L.defaults_partition_code,B.price_sqyd=L.defaults_partition_price_sqyd);break;case"pleated_screen":R("pleated_screen")&&(B.code=L.defaults_pleated_screen_code,B.price_sqyd=L.defaults_pleated_screen_price_sqyd);break;case"aluminum_blind":R("aluminum_blind")&&(B.code=L.defaults_aluminum_blind_code,B.price_sqyd=L.defaults_aluminum_blind_price_sqyd);break}let x;if(k==="set")x=ke(B);else if(k==="wallpaper")x=xe(B);else if(k==="removal")x=Ce(B);else if(W[k]?.templateId==="#areaBasedTpl")x=Le(k,B);else{q(`‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${k}`,"error");break}if(!x)break;const P=m.getItemsContainer();if(P){P.appendChild(x),x.classList.add("item-created"),he(x);let j=x.querySelector('input[name="width_m"], input[name="area_width_m"], input[name="wallpaper_height_m"], input[name="quantity"]');j?j.focus():x.querySelector('input:not([type="hidden"]), select, textarea')?.focus(),le(),X(),q(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${W[k]?.name||"‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"} ‡πÅ‡∏•‡πâ‡∏ß (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡∏ô‡∏≤‡∏î)`,"success")}}break}case"add-dimension-row":{const p=document.querySelector("#dimensionRowsContainer");if(p){const y=vt();p.appendChild(y),y.querySelector('input[name="modal_width_m"]')?.focus(),p.scrollTop=p.scrollHeight}break}case"remove-dimension-row":{const p=i.closest(".dimension-input-row"),y=p?.parentElement;p&&y&&y.children.length>1&&p.remove();break}case"select-item-type":if(u&&u.classList.contains("placeholder-item")){const p={width_m:parseFloat(u.dataset.widthM||0),height_m:parseFloat(u.dataset.heightM||0)};if(p.width_m>0&&p.height_m>0){const y=await Mt("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤");y&&$o(u,y,p)}else q("‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏ô Placeholder","error")}break;case"collapse-room":m&&(m.open=!1,setTimeout(()=>{pe(),ne()},50));break;case"toggle-room-menu":i.nextElementSibling?.classList.toggle("show");break;case"open-room-defaults":m&&(vo(m),i.closest(".room-options-menu")?.classList.remove("show"));break;case"open-force-apply-modal":bo();break;case"force-apply-defaults":wo();break;case"toggle-suspend-room":m&&(m.classList.toggle("is-suspended"),i.closest(".room-options-menu")?.classList.remove("show"),X(),we==="suspended"?Ke():qe());break;case"clear-room":m&&await de("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á","?")&&(ue(K()),oe(),m.getItemsContainer().innerHTML="",le(),X(),q("‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß","success"));break;case"del-room":m&&await de("‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á","?")&&Xe(m,"‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß");break;case"del-item":u&&await de("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","?")&&Xe(u,"‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß");break;case"duplicate-item":u&&xo(u);break;case"toggle-suspend":u&&(u.classList.toggle("is-suspended"),X(),we==="suspended"?Ke():qe());break;case"change-type":u&&ko(u);break;case"toggle-more-details":u&&!u.querySelector(".item-details-more")?.classList.contains("show")&&document.querySelectorAll(".item-details-more.show").forEach(p=>{p.closest(".item-card")!==u&&je(p.closest(".item-card"),!1)}),je(u);break;case"open-hardware-modal":Eo(u),Me()&&ho();break;case"apply-hardware-to-room":{const p=i.closest("#hardwareModal"),y=Me()?.closest(_.room);if(!p||!y||!Me())break;const v=Me().querySelector('[name="set_style"]');if(v?.value==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"||v?.value==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"){q("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå‡πÑ‡∏î‡πâ","warning");break}const k=p.querySelector('[name="modal_track_color"]').value,L=p.querySelector('[name="modal_bracket_color"]').value,B=p.querySelector('[name="modal_finial_color"]').value,R=p.querySelector('[name="modal_grommet_color"]').value;y.querySelectorAll('.set-item:not(:has(select[name="set_style"][value="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"])):not(:has(select[name="set_style"][value="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"]))').forEach(x=>{x.querySelector('[name="track_color"]').value=k,x.querySelector('[name="bracket_color"]').value=L,x.querySelector('select[name="set_style"]')?.value==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"&&(x.querySelector('[name="finial_color"]').value=B,x.querySelector('[name="grommet_color"]').value=R)}),ne(),q("‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß","success");break}case"add-wall":{const p=i.closest(".walls-section")?.querySelector("[data-walls-container]");if(p){const y=createWall();y&&(p.appendChild(y),y.querySelector("input")?.focus(),X())}break}case"del-wall":{const p=i.closest(".wall-input-row");p&&await de("‡∏•‡∏ö‡∏ú‡∏ô‡∏±‡∏á","?")&&Xe(p,"‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß");break}case"show-favorites":{const p=i.previousElementSibling?.matches("input[data-favorite-type]")?i.previousElementSibling:i.closest(".form-group-with-favorites")?.querySelector("input[data-favorite-type]");p?To(p):console.warn("Could not find associated input for show-favorites button:",i);break}case"add-new-fav-form":{const y=i.closest("#favManagerModal")?.dataset.currentType;if(!y)break;const v=document.querySelector("#favAddModal");if(!v)break;let k=W[y]?.name||y;y==="fabric"?k="‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö":y==="sheer"&&(k="‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á"),v.querySelector("h3").textContent=`‡πÄ‡∏û‡∏¥‡πà‡∏° '${k}'`;const L=v.querySelector('[name="fav_code_add"]'),B=v.querySelector('[name="fav_price_add"]');L.value="",B.value="";const R=await J("#favAddModal");if(R&&!R.cancelled){const x=L.value.trim(),P=h(B.value);x&&P>=0?ut(y,x,P)?(He(!0),Oe(y),q("‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß","success")):q("‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error"):q(x?"‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏•‡∏ö":"‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™","warning")}break}case"edit-selected-fav":{if(!ae())break;const y=i.closest("#favManagerModal")?.dataset.currentType;if(!y)break;const v=document.querySelector("#favEditModal");if(!v)break;v.querySelector("h3").textContent=`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç '${ae().code}'`;const k=v.querySelector('[name="fav_code_edit"]'),L=v.querySelector('[name="fav_price_edit"]');k.value=ae().code,L.value=ae().price!==null&&ae().price>=0?ae().price:"";const B=await J("#favEditModal");if(B&&!B.cancelled){const R=k.value.trim(),x=h(L.value);R&&x>=0?(R!==ae().code&&pt(y,ae().code),ut(y,R,x),He(!0),Oe(y),q("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß","success")):q(R?"‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏•‡∏ö":"‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™","warning")}break}case"del-selected-fav":{if(!ae())break;const y=i.closest("#favManagerModal")?.dataset.currentType;if(!y)break;await de("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î",`"${ae().code}"?`)&&(pt(y,ae().code)?(He(!0),Oe(y),q("‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß","success")):q("‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error"));break}case"jump-to-item":Lo(i);break;case"close-modal":{const p=i.closest(".modal-wrapper");p&&typeof p.closeModal=="function"?Q.length>0&&Q[Q.length-1]===p&&p.closeModal({cancelled:!0}):p&&console.warn("Modal is missing .closeModal() function.",p);break}}}else{const f=t.target.closest("summary");f&&f.closest("details.card")&&setTimeout(()=>{pe(),ne()},50)}}),document.querySelector("#undoBtn")?.addEventListener("click",t=>{t.preventDefault(),No()}),document.querySelector(_.lockBtn)?.addEventListener("click",t=>{t.preventDefault(),Oo()}),document.querySelector(_.toggleAllRoomsBtn)?.addEventListener("click",t=>{t.preventDefault(),Ho()}),c&&a){c.addEventListener("click",l=>{l.stopPropagation(),o?.classList.remove("show");const d=!a.classList.contains("show");a.classList.toggle("show",d),c.setAttribute("aria-expanded",d),d&&r?.setAttribute("aria-expanded","false")}),document.querySelector(_.quickNavRoomList)?.addEventListener("click",l=>{const d=l.target.closest("a[data-jump-to]");if(d){l.preventDefault();const i=d.dataset.jumpTo,f=document.getElementById(i);f&&(f.open=!0,st(f),f.classList.add("scrolling-jump"),setTimeout(()=>f.classList.remove("scrolling-jump"),2500),setTimeout(pe,100)),a.classList.remove("show"),c.setAttribute("aria-expanded","false")}});const t=document.querySelector("#addRoomQuickNavBtn");if(t){const l=Ut(Se,700);t.addEventListener("click",d=>{d.stopPropagation(),l(),a.classList.remove("show"),c.setAttribute("aria-expanded","false")})}}r&&o&&r.addEventListener("click",t=>{t.stopPropagation(),a?.classList.remove("show");const l=!o.classList.contains("show");o.classList.toggle("show",l),r.setAttribute("aria-expanded",l),l&&c?.setAttribute("aria-expanded","false")}),document.querySelector("#themeToggleBtn")?.addEventListener("click",t=>{t.preventDefault(),Ro(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false")}),document.querySelector("#overviewBtn")?.addEventListener("click",async t=>{t.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false");const l=K(),d=document.querySelector("#overviewModalHeader"),i=document.querySelector("#overviewModalBody");if(d&&i){const f=l.rooms.reduce((b,p)=>b+(p.is_suspended?0:(p.items||[]).filter(y=>!y.is_placeholder&&!y.is_suspended&&(F.calculateSetPrice(y)?.total>0||F.calculateWallpaperPrice(y)?.total>0||F.calculateRemovalPrice(y)?.total>0||F.calculateAreaBasedPrice(y)?.total>0)).length),0),u=document.querySelector(_.grandTotal)?.textContent||"0",m=l.rooms.filter(b=>!b.is_suspended&&b.items?.some(p=>!p.is_suspended)).length;d.innerHTML=`<div class="overview-stats-grid"><div class="overview-stat-card"><i class="ph-bold ph-map-pin-line"></i><div class="stat-value">${m}</div><div class="stat-label">‡∏´‡πâ‡∏≠‡∏á</div></div><div class="overview-stat-card"><i class="ph-bold ph-stack"></i><div class="stat-value">${f}</div><div class="stat-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div></div><div class="overview-stat-card"><i class="ph-bold ph-coins"></i><div class="stat-value">${u}</div><div class="stat-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</div></div></div>`,i.innerHTML=lo(l),J("#overviewModal")}}),document.querySelector("#copyTextBtn")?.addEventListener("click",async t=>{t.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false");const l=document.querySelector(_.copyOptionsModal);if(!l)return;l.querySelector('input[name="copy_option"][value="customer"]').checked=!0;const d=await J(_.copyOptionsModal);if(d&&!d.cancelled){const i=l.querySelector('input[name="copy_option"]:checked').value,f=so(K(),i);try{await navigator.clipboard.writeText(f),q("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!","success")}catch{q("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}}),document.querySelector("#visualReportsBtn")?.addEventListener("click",async t=>{t.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false");const l=document.querySelector("#visualReportsModal");if(!l)return;l.querySelector('input[name="report_type_option"][value="lookbook"]').checked=!0;const d=await J("#visualReportsModal");if(d&&!d.cancelled){const i=l.querySelector('input[name="report_type_option"]:checked').value;if(i==="lookbook"){const f=K(),u=uo(f),m=document.querySelector("#lookbookModalBody");u&&m?(m.innerHTML=u,J("#lookbookModal")):q("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","warning")}else q(`'${i}' ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°`,"default")}}),document.querySelector(_.shopSettingsBtn)?.addEventListener("click",async t=>{t.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false"),document.querySelector(_.shopSettingsModal)?(St(),J(_.shopSettingsModal)):(console.error("Shop settings modal element not found."),q("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤","error"))}),document.querySelector(_.exportPdfBtn)?.addEventListener("click",async t=>{t.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false");const l=await po();if(!l)return;const d=K(),i=io(d,{vatRate:l.vatOption==="include"?Be().baseVatRate:0,pageBreakBuffer:l.pageBreakBuffer,showDetails:l.showDetails});if(!i){q("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","warning");return}l.exportMethod==="html"?Wo(i):jo(i.html,l.exportMethod)}),document.querySelector(_.submitBtn)?.addEventListener("click",async t=>{if(t.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false"),await de("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","?")){const l=K();if(!l.customer_name&&!l.customer_phone){q("‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠/‡πÄ‡∏ö‡∏≠‡∏£‡πå","warning");return}q("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...","default");try{q("‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Webhook) ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤","error")}catch{q("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î","error")}}}),document.querySelector(_.importBtn)?.addEventListener("click",t=>{t.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false"),n?.click()}),n?.addEventListener("change",t=>{const l=t.target.files?.[0];if(!l)return;const d=new FileReader;d.onload=async i=>{try{const f=JSON.parse(i.target.result);if(f&&typeof f=="object")await lt(f,!0);else throw new Error("Invalid JSON")}catch(f){q("‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å","error"),console.error(f)}},d.readAsText(l),t.target.value=null}),document.querySelector(_.exportBtn)?.addEventListener("click",t=>{t.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false");try{const l=K(),d=JSON.stringify(l,null,4),i=new Blob([d],{type:"application/json"}),f=URL.createObjectURL(i),u=document.createElement("a"),m=new Date,b=`${m.getFullYear()}${(m.getMonth()+1).toString().padStart(2,"0")}${m.getDate().toString().padStart(2,"0")}`,p=`${m.getHours().toString().padStart(2,"0")}${m.getMinutes().toString().padStart(2,"0")}`,y=$t(l.customer_name||"data");u.href=f,u.download=`MTR-${b}${p}-${y}.json`,u.click(),URL.revokeObjectURL(f),q("Export ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch{q("Export ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}),document.querySelector("#importFavsBtn")?.addEventListener("click",t=>{t.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false"),s?.click()}),s?.addEventListener("change",t=>{const l=t.target.files?.[0];if(!l)return;const d=new FileReader;d.onload=i=>{try{const f=JSON.parse(i.target.result),u=Ze(f);u>0?q(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${u} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`,"success"):q("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà","default")}catch{q("‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å","error")}},d.readAsText(l),t.target.value=null}),document.querySelector("#exportFavsBtn")?.addEventListener("click",t=>{t.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false");try{const l=ge();if(Object.values(l).every(b=>b.length===0)){q("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","warning");return}const d=JSON.stringify(l,null,4),i=new Blob([d],{type:"application/json"}),f=URL.createObjectURL(i),u=document.createElement("a"),m=new Date().toISOString().slice(0,10).replace(/-/g,"");u.href=f,u.download=`MTR-Favorites-${m}.json`,u.click(),URL.revokeObjectURL(f),q("Export ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch{q("Export ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}),document.querySelector(_.clearItemsBtn)?.addEventListener("click",async t=>{if(t.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false"),await de("‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","?")){ue(K()),oe(),document.querySelectorAll(_.room).forEach(i=>{i.getItemsContainer().innerHTML=""});const l=document.querySelector("#discount_type"),d=document.querySelector("#discount_value");l&&(l.value="amount"),d&&(d.value="0"),le(),X(),q("‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß","success")}}),document.querySelector(_.clearAllBtn)?.addEventListener("click",async t=>{if(t.preventDefault(),o?.classList.remove("show"),r?.setAttribute("aria-expanded","false"),await de("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î","‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")){const l=document.querySelector(_.roomsContainer);l&&(l.innerHTML=""),localStorage.removeItem(Te),Yt(),q("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î...","success"),setTimeout(()=>window.location.reload(),500)}}),document.querySelector("#roomDefaultsConfirmBtn")?.addEventListener("click",go),window.addEventListener("click",t=>{t.target.closest(".menu-container")||(o?.classList.remove("show"),a?.classList.remove("show"),r?.setAttribute("aria-expanded","false"),c?.setAttribute("aria-expanded","false")),t.target.closest(".room-options-container")||document.querySelectorAll(".room-options-menu.show").forEach(d=>d.classList.remove("show"));const l=t.target.closest(".item-card");document.querySelectorAll(".item-details-more.show").forEach(d=>{const i=d.closest(".item-card");i!==l&&je(i,!1)})}),window.addEventListener("beforeunload",ne),document.querySelector("#forceApplySelectTypeBtn")?.addEventListener("click",async t=>{if(t.preventDefault(),se){q("‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¢‡∏π‡πà","warning");return}const l=document.querySelector("#forceApplyTypeModal");if(!l)return;const d=document.querySelector('#forceApplyModal [name="force_apply_type_hidden"]')?.value;let i=l.querySelector(`input[name="force_apply_type_option"][value="${d}"]`);i||(i=l.querySelector('input[name="force_apply_type_option"]')),i&&(i.checked=!0);const f=await J("#forceApplyTypeModal");if(f&&!f.cancelled){const u=l.querySelector('input[name="force_apply_type_option"]:checked');if(u){const m=u.value,b=document.querySelector("#forceApplyModal"),p=b?.querySelector('[name="force_apply_type_hidden"]'),y=b?.querySelector("#forceApplySelectedTypeDisplay"),v=b?.querySelector('[name="force_apply_code"]'),k=v?.closest(".form-group-with-favorites")?.querySelector(".btn-show-favs"),L=u.closest("label")?.querySelector("strong"),B=L?L.textContent.trim():m;p&&(p.value=m),y&&(y.textContent=B),v&&(v.dataset.favoriteType=m,v.focus()),k&&(k.disabled=!1)}}})}}function Go(){const e=document.querySelector(_.setTpl);if(!e)return;const n=e.content.querySelector(_.setPricePerMSelect),s=e.content.querySelector(_.setSheerPricePerMSelect),o=e.content.querySelector(_.setLouisPricePerMSelect),a=r=>{let c='<option value="" hidden>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤</option>';return Array.isArray(r)?(r.forEach(t=>{c+=`<option value="${t}">${t.toLocaleString("th-TH")}</option>`}),c):(console.error("Price data for dropdown is not available or not an array.",r),c)};n&&(n.innerHTML=a(Fe.fabric)),s&&(s.innerHTML=a(Fe.sheer)),o&&(o.innerHTML=a(Fe.louis))}function Uo(){Nt(),Go(),Vo(),Tt();try{const e=localStorage.getItem(Te);if(e&&e!=="null"&&e!=="{}"){const n=JSON.parse(e);if(n&&Array.isArray(n.rooms))lt(n,!1);else{console.warn("Stored data structure seems invalid, starting fresh."),localStorage.removeItem(Te),Se();const s=document.querySelector(_.customerCard);s&&(s.open=!0)}}else{Se();const n=document.querySelector(_.customerCard);n&&(n.open=!0)}}catch(e){console.error("Failed to load or parse data from localStorage:",e),localStorage.removeItem(Te),Se();const n=document.querySelector(_.customerCard);n&&(n.open=!0)}X(),Ot(),pe(),Ee(),oe(),console.log("Marnthara App Initialized (Vite Refactor)")}document.addEventListener("DOMContentLoaded",Uo);
